<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=6.7.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=6.7.0"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=6.7.0"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=6.7.0"><link rel="mask-icon" href="/favicon.ico?v=6.7.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"6.7.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="译者自序:仅是自己学习的时候顺便翻译下,仅当做笔记加深印象之用,并未对所翻译内容进行过复查和校对,应该会有大量狗屁不通的地方,建议还是看官方原文"><meta name="keywords" content="Angularjs2"><meta property="og:type" content="article"><meta property="og:title" content="Angularjs2教程:英雄之途"><meta property="og:url" content="http://zfeiyu.com/2016/06/17/angularjs2-TUTORIAL-TOUR-OF-HEROES/index.html"><meta property="og:site_name" content="临渊羡鱼"><meta property="og:description" content="译者自序:仅是自己学习的时候顺便翻译下,仅当做笔记加深印象之用,并未对所翻译内容进行过复查和校对,应该会有大量狗屁不通的地方,建议还是看官方原文"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/heroes-dashboard-1.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/hero-details-1.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/heroes-list-2.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/nav-diagram.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/toh-anim.gif"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/heroes-list-1.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/nav-diagram.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/mini-hero-detail.png"><meta property="og:image" content="http://zfeiyu.com/res/img/angularjs2/dashboard-top-heroes.png"><meta property="og:updated_time" content="2016-10-30T11:05:50.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Angularjs2教程:英雄之途"><meta name="twitter:description" content="译者自序:仅是自己学习的时候顺便翻译下,仅当做笔记加深印象之用,并未对所翻译内容进行过复查和校对,应该会有大量狗屁不通的地方,建议还是看官方原文"><meta name="twitter:image" content="http://zfeiyu.com/res/img/angularjs2/heroes-dashboard-1.png"><link rel="alternate" href="/atom.xml" title="临渊羡鱼" type="application/atom+xml"><link rel="canonical" href="http://zfeiyu.com/2016/06/17/angularjs2-TUTORIAL-TOUR-OF-HEROES/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>Angularjs2教程:英雄之途 | 临渊羡鱼</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?1c798eaf80ffa31d9a4c27b209ffb502";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta custom-logo"><span class="logo-line-before"><i></i></span> <img class="site-logo" src="/logo.png" alt="临渊羡鱼"><span class="logo-line-after"><i></i></span><h1 class="site-subtitle" itemprop="description">丝禽藏荷香，锦鲤绕岛影。</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"> <a href="/" rel="section">首页</a></li><li class="menu-item menu-item-tags"> <a href="/tags/" rel="section">标签</a></li><li class="menu-item menu-item-archives"> <a href="/archives/" rel="section">归档</a></li><li class="menu-item menu-item-talks"> <a href="/talks/" rel="section">talks</a></li><li class="menu-item menu-item-search"> <a href="javascript:;" class="popup-trigger">搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://zfeiyu.com/2016/06/17/angularjs2-TUTORIAL-TOUR-OF-HEROES/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="lizorn"><meta itemprop="description" content="想法永远是错的，除非事实证明它是对的。"><meta itemprop="image" content="/res/avatar.png"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="临渊羡鱼"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Angularjs2教程:英雄之途</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2016-06-17 00:00:00" itemprop="dateCreated datePublished" datetime="2016-06-17T00:00:00+08:00">2016-06-17</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2016-10-30 19:05:50" itemprop="dateModified" datetime="2016-10-30T19:05:50+08:00">2016-10-30</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/开发者手册/" itemprop="url" rel="index"><span itemprop="name">开发者手册</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数：<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-description">译者自序:仅是自己学习的时候顺便翻译下,仅当做笔记加深印象之用,并未对所翻译内容进行过复查和校对,应该会有大量狗屁不通的地方,建议还是看官方原文</div></div></header><div class="post-body" itemprop="articleBody"><p><em>转摘请说明出处!</em></p><p><em>译者自序:仅是自己学习的时候顺便翻译下,仅当做笔记加深印象之用,并未对所翻译内容进行过复查和校对,应该会有大量狗屁不通的地方,建议还是看<a href="https://angular.io/docs/ts/latest/tutorial/" target="_blank" rel="noopener">官方原文</a>吧</em></p><p><em>Tour of Heroes</em>教程一步一步教大家如何用TypeScript写Angular应用.*</p><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><h2 id="英雄之旅-预览"><a href="#英雄之旅-预览" class="headerlink" title="英雄之旅:预览"></a>英雄之旅:预览</h2><p>我们更大的计划是创建一个应用,帮助人员管理机构来管理英雄们,即使是英雄他也需要有一份工作.</p><p>当然本教程会进一步深入使用Angular来构建应用.在一个成熟的,数据驱动的应用中我们需要购将非常多的功能:获取和展示英雄列表,编辑选中的英雄细节,英雄数据视图导航等.</p><p>英雄之旅覆盖了Angular的核心功能,我们使用内置指令显示/隐藏元素并展示英雄数据列表.我们创建一个组件用于展示英雄细节,另外一个组件用于显示所有的英雄列表.我们增加一个可编辑字段通过双向数据绑定的形式更新model.我们将组件的方法绑定到用户事件上,如键盘敲击或者鼠标点击.我们将学习如何从主列表内选择英雄并在细节视图里编辑他.我们通过pipes格式化数据.我们将会创建一个共享服务来收集我们的英雄.我们将使用路由功能来实现不同视图和组件之间的导航.</p><p>我们将会接触到足够多的Angular的核心功能,我们会发现Angular很强大几乎可以用来实现任何的应用.<br><a href="https://angular.io/resources/live-examples/toh-6/ts/plnkr.html" target="_blank" rel="noopener">在线示例</a></p><h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><p>这是这个应用的最终效果,从仪表盘可以浏览我们的主要应用:<br><img src="/res/img/angularjs2/heroes-dashboard-1.png" alt=""><br>仪表盘上面有两个链接(“Dashboard”和”英雄们”).我们可以通过点击它们导航到这个仪表盘和英雄视图中.</p><p>我们点击仪表盘上的名为”Magneta”的英雄,会有这个英雄的细节展示,并且我们可以修改英雄的名字.<br><img src="/res/img/angularjs2/hero-details-1.png" alt=""><br>点击”Back”按键,我们可以返回”Dashboard”.顶部的导航栏可以带我们进入任一一个主要视图.我们点击”Heroes”,应用就会展示英雄们的列表视图.<br><img src="/res/img/angularjs2/heroes-list-2.png" alt=""><br>我们点击不同的英雄,会有一个可读的小细节展示到我们的点击处.</p><p>下图列出了我们导航栏的选择流程图:<br><img src="/res/img/angularjs2/nav-diagram.png" alt=""><br>以下是APP的动画效果:<br><img src="/res/img/angularjs2/toh-anim.gif" alt=""></p><h2 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h2><p>我们开始一步步构建英雄之旅这个应用了,我们每一步都是为了解决应用中某个需求为目的的.我们一起来见识下Angular非常多的核心功能.</p><h1 id="英雄编辑器"><a href="#英雄编辑器" class="headerlink" title="英雄编辑器"></a>英雄编辑器</h1><h2 id="从前…"><a href="#从前…" class="headerlink" title="从前…"></a>从前…</h2><p>每一个故事都得从某一个时间开始,我们的故事从QuickStart教程介绍开始.</p><p>运行教程这部分的示例: <a href="https://angular.io/resources/live-examples/toh-1/ts/plnkr.html" target="_blank" rel="noopener">live example</a></p><p>创建一个名为<code>angular2-tour-of-heroes</code>的文件夹,并跟着快速入门教程进行工程的预配置和安装.</p><blockquote><p>你也可以直接下载<a href="https://github.com/angular/quickstart/blob/master/README.md" target="_blank" rel="noopener">快速入门源码</a></p></blockquote><p>最终结构如下:<br>我们最终的工程文件结构如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">--angular2-quickstart</span><br><span class="line"></span><br><span class="line">----app</span><br><span class="line"></span><br><span class="line">------app.component.ts</span><br><span class="line"></span><br><span class="line">------main.ts</span><br><span class="line"></span><br><span class="line">----node_modules ...</span><br><span class="line"></span><br><span class="line">----typings ...</span><br><span class="line"></span><br><span class="line">----index.html</span><br><span class="line"></span><br><span class="line">----package.json</span><br><span class="line"></span><br><span class="line">----styles.css</span><br><span class="line"></span><br><span class="line">----systemjs.config.js</span><br><span class="line"></span><br><span class="line">----tsconfig.json</span><br><span class="line"></span><br><span class="line">----typings.json</span><br></pre></td></tr></table></figure><p></p><h2 id="保持app在线编译和运行"><a href="#保持app在线编译和运行" class="headerlink" title="保持app在线编译和运行"></a>保持app在线编译和运行</h2><p>实时监控文件改变,编译TypeScript并更新app,我们只需:</p><p><code>npm start</code></p><p>这个命令运行编译器的观察模式,启动服务,在浏览器里打开应用,并维持app持续构建和运行.</p><h2 id="英雄展示"><a href="#英雄展示" class="headerlink" title="英雄展示"></a>英雄展示</h2><p>我们想在APP里显示英雄.让我们增加两个特性到<code>AppComponent</code>, <code>title</code>表示应用的名字,<code>hero</code>赋值一个英雄,名为<code>Windstorm</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export class AppComponent &#123;</span><br><span class="line">  title = &apos;Tour of Heroes&apos;;</span><br><span class="line">  hero = &apos;Windstorm&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更新@component装饰器里的模板,将数据绑定到新的特性里.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template: &apos;&lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;&lt;h2&gt;&#123;&#123;hero&#125;&#125; details!&lt;/h2&gt;&apos;</span><br></pre></td></tr></table></figure><p>此时浏览器应该会刷新并显示title和英雄名.</p><p>双大括号表示读取和渲染组件内的<code>title</code>和<code>hero</code>特性,这是单向数据绑定的”插值”形式.</p><blockquote><p>关于’插值’更详细的信息请查看 <a href="https://angular.io/docs/ts/latest/guide/displaying-data.html" target="_blank" rel="noopener">数据展示章节</a></p></blockquote><h3 id="英雄对象"><a href="#英雄对象" class="headerlink" title="英雄对象"></a>英雄对象</h3><p>现在,我们的英雄就只有一个名字而已,我们想要更多的特性,我们需要把它转换成类.</p><p>创建一个带有<code>id</code>和<code>name</code>特性的<code>Hero</code>类,暂时放到<code>app.component.ts</code>文件里,import语句之下.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export class Hero &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在我们有了<code>Hero</code>类,让我们重构下<code>hero</code>特性:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hero: Hero = &#123;</span><br><span class="line">  id:1,</span><br><span class="line">  hero:&apos;Windstorm&apos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>hero</code>特性从字符串变成了类,修改模板里的对应字段:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template: &apos;&lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;&lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details&lt;/h2&gt;&apos;</span><br></pre></td></tr></table></figure><h3 id="修改HTML模板"><a href="#修改HTML模板" class="headerlink" title="修改HTML模板"></a>修改HTML模板</h3><p>我们现在需要显示更多的信息,不仅仅是名字,修改下html模板:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">template:`</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">  &lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;hero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;&lt;label&gt;name: &lt;/label&gt;&#123;&#123;hero.name&#125;&#125;&lt;/div&gt;</span><br><span class="line">  `</span><br></pre></td></tr></table></figure><h2 id="编辑英雄"><a href="#编辑英雄" class="headerlink" title="编辑英雄"></a>编辑英雄</h2><p>我们需要在文本框里编辑英雄的名字,重构英雄名字部分的模板,增加一个<code>&lt;input&gt;</code>元素.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">template:`</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">  &lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;hero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">    &lt;input value=&quot;&#123;&#123;hero.name&#125;&#125;&quot; placeholder=&quot;name&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  `</span><br></pre></td></tr></table></figure><p>现在浏览器上英雄名字确实显示到了<code>&lt;input&gt;</code>文本框里.但似乎有些不对,当我们改变名字的时候,我们发现这些改变并没有反应到<code>&lt;h2&gt;</code>里.这种单向绑定到<code>&lt;input&gt;</code>的形式无法满足需求.</p><h3 id="双向绑定"><a href="#双向绑定" class="headerlink" title="双向绑定"></a>双向绑定</h3><p>我们现在的需求是这样的,<code>&lt;input&gt;</code>框内显示英雄的名字,修改它,绑定了这个英雄名字的其他地方都需要对应改变.简而言之,我们想要双向数据绑定.</p><p>让我们使用<code>ngModel</code>这个内置指令来实现双向绑定.</p><blockquote><p>关于<code>ngModel</code>的更多信息可以查看<a href="https://angular.io/docs/ts/latest/guide/forms.html#ngModel" target="_blank" rel="noopener"><code>表单</code></a>和<a href="https://angular.io/docs/ts/latest/guide/template-syntax.html#ngModel" target="_blank" rel="noopener"><code>模板语法</code></a>章节</p></blockquote><p>用以下HTML替换<code>&lt;input&gt;</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input [(ngModel)]=&quot;hero.name&quot; placeholder=&quot;name&quot;&gt;</span><br></pre></td></tr></table></figure><p>刷新浏览器,我们再次编辑英雄的名字,可以发现<code>&lt;h2&gt;</code>里的内容也可以联动起来了.</p><h3 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a>本章小结</h3><p>让我们看看本章做了些什么.</p><ul><li>英雄之旅使用大括号插入显示应用的<code>title</code>以及<code>hero</code>对象特性.</li><li>通过使用内建指令<code>ngModel</code>对<code>&lt;input&gt;</code>元素和组件数据进行双向绑定</li><li><code>ngModel</code>指令将数据变化响应到绑定的<code>hero.name</code>特性上.</li></ul><p><code>app.component.ts</code>代码如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line">export class Hero &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">    &lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;hero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">      &lt;input [(ngModel)]=&quot;hero.name&quot; placeholder=&quot;name&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  title = &apos;Tour of Heroes&apos;;</span><br><span class="line">  hero: Hero = &#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    name: &apos;Windstorm&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="未来之路"><a href="#未来之路" class="headerlink" title="未来之路"></a>未来之路</h3><p>现在的应用只展示了一个英雄,我们希望展示一个英雄的列表,同时允许用户可以点击选择查看他们的详情.下一章节,我们将会学习到如何获取一个列表,并将他们绑定到模板上,渲染到页面可供用户选择.</p><h1 id="Master-Detail"><a href="#Master-Detail" class="headerlink" title="Master/Detail"></a>Master/Detail</h1><h2 id="有很多英雄"><a href="#有很多英雄" class="headerlink" title="有很多英雄"></a>有很多英雄</h2><p>我们的故事需要更多的英雄.我们可以扩展英雄之旅APP展示英雄列表,允许用户选择英雄并显示英雄的详情.</p><p>这部分的<a href="https://angular.io/resources/live-examples/toh-2/ts/plnkr.html" target="_blank" rel="noopener">在线示例</a>.</p><p>让我们来预估下显示一个英雄列表需要做点什么. 首先,我们需要一个英雄的列表数据.然后,我们将它通过视图模板展示出来.</p><h2 id="显示英雄们"><a href="#显示英雄们" class="headerlink" title="显示英雄们"></a>显示英雄们</h2><h3 id="创建英雄数据"><a href="#创建英雄数据" class="headerlink" title="创建英雄数据"></a>创建英雄数据</h3><p>在<code>app.component.ts</code>底部创建一个包含10个英雄的数组.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const HEROES: Hero[] = [</span><br><span class="line">  &#123; id: 11, name: &apos;Mr. Nice&apos; &#125;,</span><br><span class="line">  &#123; id: 12, name: &apos;Narco&apos; &#125;,</span><br><span class="line">  &#123; id: 13, name: &apos;Bombasto&apos; &#125;,</span><br><span class="line">  &#123; id: 14, name: &apos;Celeritas&apos; &#125;,</span><br><span class="line">  &#123; id: 15, name: &apos;Magneta&apos; &#125;,</span><br><span class="line">  &#123; id: 16, name: &apos;RubberMan&apos; &#125;,</span><br><span class="line">  &#123; id: 17, name: &apos;Dynama&apos; &#125;,</span><br><span class="line">  &#123; id: 18, name: &apos;Dr IQ&apos; &#125;,</span><br><span class="line">  &#123; id: 19, name: &apos;Magma&apos; &#125;,</span><br><span class="line">  &#123; id: 20, name: &apos;Tornado&apos; &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>数组<code>HEROES</code>是<code>Hero</code>类型的,类型已在上一章节定义,为了创建这个英雄数组.我们最终希望可以从web service获取这个列表,目前我们先用模拟数据代替.</p><h3 id="展示英雄"><a href="#展示英雄" class="headerlink" title="展示英雄"></a>展示英雄</h3><p><code>AppComponent</code>里创建一个public的heroes特性并绑定.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public heroes = HEROES;</span><br></pre></td></tr></table></figure><p>我们并不需要声明heroes类型,TS可以隐式赋值为<code>HEROES</code>数组.</p><h3 id="在模板里展示英雄"><a href="#在模板里展示英雄" class="headerlink" title="在模板里展示英雄"></a>在模板里展示英雄</h3><p>我们的组件有<code>heroes</code>,让我们再创建一个无序列表.将以下的HTML代码插入到模板里.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;My Heroes&lt;/h2&gt;</span><br><span class="line">&lt;ul class=&quot;heroes&quot;&gt;</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;!-- each hero goes here --&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><p>现在我们已经有模板了,开始填充英雄数据.</p><h3 id="使用ngFor展示英雄列表"><a href="#使用ngFor展示英雄列表" class="headerlink" title="使用ngFor展示英雄列表"></a>使用ngFor展示英雄列表</h3><p>我们想绑定<code>heroes</code>数组绑定到组件的模板里,并迭代渲染展示他们.</p><p>首先修改<code>&lt;li&gt;</code>标签,增加内置指令<code>*ngFor</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li *ngFor=&quot;let hero of heroes&quot; &gt;</span><br></pre></td></tr></table></figure><blockquote><p>前置符<code>*</code>表示<code>&lt;li&gt;</code>元素节点以及它的子孙节点组成一个主模板.<code>ngFor</code>指令迭代<code>AppComponent.heroes</code>数组,并放入<code>hero</code>变量中.</p></blockquote><p>现在我们可以在<code>&lt;li&gt;</code>标签里插入一些内容了:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;li *ngFor=&quot;let hero of heroes&quot;&gt;</span><br><span class="line">  &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><h3 id="样式化"><a href="#样式化" class="headerlink" title="样式化"></a>样式化</h3><p>我们的英雄列表看起来比较乏味,我们需要一些视觉效果,如在某个英雄上鼠标悬停或者英雄选择.</p><p>通过在<code>@component</code>里设置<code>styles</code>特性.将样式加入到组件.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">styles: [`</span><br><span class="line">  .selected &#123;</span><br><span class="line">    background-color: #CFD8DC !important;</span><br><span class="line">    color: white;</span><br><span class="line">  &#125;</span><br><span class="line">  .heroes &#123;</span><br><span class="line">    margin: 0 0 2em 0;</span><br><span class="line">    list-style-type: none;</span><br><span class="line">    padding: 0;</span><br><span class="line">    width: 15em;</span><br><span class="line">  &#125;</span><br><span class="line">  .heroes li &#123;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    position: relative;</span><br><span class="line">    left: 0;</span><br><span class="line">    background-color: #EEE;</span><br><span class="line">    margin: .5em;</span><br><span class="line">    padding: .3em 0;</span><br><span class="line">    height: 1.6em;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">  &#125;</span><br><span class="line">  .heroes li.selected:hover &#123;</span><br><span class="line">    background-color: #BBD8DC !important;</span><br><span class="line">    color: white;</span><br><span class="line">  &#125;</span><br><span class="line">  .heroes li:hover &#123;</span><br><span class="line">    color: #607D8B;</span><br><span class="line">    background-color: #DDD;</span><br><span class="line">    left: .1em;</span><br><span class="line">  &#125;</span><br><span class="line">  .heroes .text &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: -3px;</span><br><span class="line">  &#125;</span><br><span class="line">  .heroes .badge &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    font-size: small;</span><br><span class="line">    color: white;</span><br><span class="line">    padding: 0.8em 0.7em 0 0.7em;</span><br><span class="line">    background-color: #607D8B;</span><br><span class="line">    line-height: 1em;</span><br><span class="line">    position: relative;</span><br><span class="line">    left: -1px;</span><br><span class="line">    top: -4px;</span><br><span class="line">    height: 1.8em;</span><br><span class="line">    margin-right: .8em;</span><br><span class="line">    border-radius: 4px 0 0 4px;</span><br><span class="line">  &#125;</span><br><span class="line">`]</span><br></pre></td></tr></table></figure><p>请注意,组件样式只有该组件有效,不会影响到其他的HTML.现在用于展示英雄列表的模板如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;My Heroes&lt;/h2&gt;</span><br><span class="line">&lt;ul class=&quot;heroes&quot;&gt;</span><br><span class="line">  &lt;li *ngFor=&quot;let hero of heroes&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><h2 id="选择英雄"><a href="#选择英雄" class="headerlink" title="选择英雄"></a>选择英雄</h2><p>我们有一个英雄列表,我们也有了单个英雄的显示界面,但目前两者还没有关联起来.我们接下来想要做的是,在英雄列表里点击英雄,可以查看这个英雄的详情.这种<code>UI</code>模式就是广泛使用的<code>master-detail</code>.在这个示例中,<code>master</code>是英雄列表,<code>detail</code>是选择的英雄.让我们通过一个绑定点击事件的<code>selectedHero</code>组件来连接<code>master</code>和<code>detail</code>.</p><h3 id="点击事件"><a href="#点击事件" class="headerlink" title="点击事件"></a>点击事件</h3><p>修改模板<code>&lt;li&gt;</code>标签,插入Angular事件绑定到鼠标点击事件.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;li *ngFor=&quot;let hero of heroes&quot; (click)=&quot;onSelect(hero)&quot;&gt;</span><br><span class="line">  &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><p>来看看事件绑定:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(click)=&quot;onSelect(hero)&quot;</span><br></pre></td></tr></table></figure><p>这个插入语指示了<code>&lt;li&gt;</code>元素是<code>click</code>事件的目标,在等于符号右边的表达式调用了<code>AppComponent</code>方法,<code>onSelect()</code>,将模板内的变量<code>hero</code>作为参数传入,这个参数就是<code>ngFor</code>遍历的变量<code>hero</code>.</p><blockquote><p>更多关于事件绑定可以查看<a href="https://angular.io/docs/ts/latest/guide/user-input.html" target="_blank" rel="noopener">用户输入</a>和<a href="https://angular.io/docs/ts/latest/guide/template-syntax.html#event-binding" target="_blank" rel="noopener">模板语法</a>章节.</p></blockquote><h3 id="增加点击句柄"><a href="#增加点击句柄" class="headerlink" title="增加点击句柄"></a>增加点击句柄</h3><p>我们的事件绑定的<code>onSelect</code>方法还没有实现,下面就来实现这个方法.</p><p>首先我们思考下,这个方法应该做些什么?它应该将组件内的选择英雄属性设置为用户点击的英雄.</p><h3 id="声明选择的英雄"><a href="#声明选择的英雄" class="headerlink" title="声明选择的英雄"></a>声明<code>选择的英雄</code></h3><p>我们现在不需<code>AppComponent</code>组件内静态的<code>hero</code>特性了,用<code>selectedHero</code>特性替换它:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectedHero: Hero;</span><br></pre></td></tr></table></figure><p><code>selectedHero</code>不进行初始化,如果用户不点击,这个值就为空.现在增加一个<code>onSelect</code>方法,将点击的<code>hero</code>特性设置为selectedHero.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onSelect(hero: Hero) &#123; this.selectedHero = hero; &#125;</span><br></pre></td></tr></table></figure><p>将模板展示数据绑定<code>selectedHero</code>特性上.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;&#123;&#123;selectedHero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">&lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;selectedHero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">    &lt;input [(ngModel)]=&quot;selectedHero.name&quot; placeholder=&quot;name&quot;/&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="使用ngIf过滤空异常"><a href="#使用ngIf过滤空异常" class="headerlink" title="使用ngIf过滤空异常"></a>使用ngIf过滤空异常</h3><p>当我们的app加载起来,我们看到英雄的列表,但此时没有英雄被选择,<code>selectedHero</code>是<code>undefined</code>.浏览器的控制窗口会有如下的打印:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXCEPTION: TypeError: Cannot read property &apos;name&apos; of undefined in [null]</span><br></pre></td></tr></table></figure><p>我们之后会将英雄的详情作为组件移除,就不存在这个问题了,但在那之前要处理掉这个问题,就需要判断<code>selectedHero</code>是否为<code>undefined</code>,我们可以使用内置<code>ngIf</code>指令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div *ngIf=&quot;selectedHero&quot;&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;selectedHero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">  &lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;selectedHero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">    &lt;input [(ngModel)]=&quot;selectedHero.name&quot; placeholder=&quot;name&quot;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>ngIf</code>和<code>ngFor</code>都叫做<code>结构指令</code>,因为他能够改变DOM的部分结构,更对内容请查看<a href="https://angular.io/docs/ts/latest/guide/structural-directives.html" target="_blank" rel="noopener">结构指令</a>和<a href="https://angular.io/docs/ts/latest/guide/template-syntax.html#directives" target="_blank" rel="noopener">模板语法</a>章节.</p></blockquote><p>刷新浏览器,我们可以看到英雄列表,但我们并没有选择英雄的详情页.当<code>selectedHero</code>为<code>undefined</code>的时候,<code>ngIf</code>从DOM过滤掉了这部分节点.当我们点击一个列表里的英雄,详情页面会出现,这就是我们想要的效果.</p><h3 id="美化slection"><a href="#美化slection" class="headerlink" title="美化slection"></a>美化<code>slection</code></h3><p>被选择的英雄没有很直观的标示在英雄列表里,我们可以使用<code>selected</code> CSS类来改变主</p><li>元素的样式.</li><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[class.selected]=&quot;hero === selectedHero&quot;</span><br></pre></td></tr></table></figure><p>中括号里的<code>class.selected</code>,这是一种特性绑定的方法,即从某个数据源(表达式 <code>hero === selectedHero</code>)单向流入到特性中.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li *ngFor=&quot;let hero of heroes&quot;</span><br><span class="line">  [class.selected]=&quot;hero === selectedHero&quot;</span><br><span class="line">  (click)=&quot;onSelect(hero)&quot;&gt;</span><br><span class="line">  &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><blockquote><p>可以在模板语法章节查看更多关于<a href="https://angular.io/docs/ts/latest/guide/template-syntax.html#property-binding" target="_blank" rel="noopener"><code>特性绑定</code></a>的内容.</p></blockquote><p>重新加载app到浏览器,我们选择英雄Magneta,就有高亮标示了.<br><img src="/res/img/angularjs2/heroes-list-1.png" alt=""></p><p>完整的<code>app.component.ts</code>代码如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line">export class Hero &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line">const HEROES: Hero[] = [</span><br><span class="line">  &#123; id: 11, name: &apos;Mr. Nice&apos; &#125;,</span><br><span class="line">  &#123; id: 12, name: &apos;Narco&apos; &#125;,</span><br><span class="line">  &#123; id: 13, name: &apos;Bombasto&apos; &#125;,</span><br><span class="line">  &#123; id: 14, name: &apos;Celeritas&apos; &#125;,</span><br><span class="line">  &#123; id: 15, name: &apos;Magneta&apos; &#125;,</span><br><span class="line">  &#123; id: 16, name: &apos;RubberMan&apos; &#125;,</span><br><span class="line">  &#123; id: 17, name: &apos;Dynama&apos; &#125;,</span><br><span class="line">  &#123; id: 18, name: &apos;Dr IQ&apos; &#125;,</span><br><span class="line">  &#123; id: 19, name: &apos;Magma&apos; &#125;,</span><br><span class="line">  &#123; id: 20, name: &apos;Tornado&apos; &#125;</span><br><span class="line">];</span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;My Heroes&lt;/h2&gt;</span><br><span class="line">    &lt;ul class=&quot;heroes&quot;&gt;</span><br><span class="line">      &lt;li *ngFor=&quot;let hero of heroes&quot;</span><br><span class="line">        [class.selected]=&quot;hero === selectedHero&quot;</span><br><span class="line">        (click)=&quot;onSelect(hero)&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;div *ngIf=&quot;selectedHero&quot;&gt;</span><br><span class="line">      &lt;h2&gt;&#123;&#123;selectedHero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">      &lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;selectedHero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">        &lt;input [(ngModel)]=&quot;selectedHero.name&quot; placeholder=&quot;name&quot;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `,</span><br><span class="line">  styles: [`</span><br><span class="line">    .selected &#123;</span><br><span class="line">      background-color: #CFD8DC !important;</span><br><span class="line">      color: white;</span><br><span class="line">    &#125;</span><br><span class="line">    .heroes &#123;</span><br><span class="line">      margin: 0 0 2em 0;</span><br><span class="line">      list-style-type: none;</span><br><span class="line">      padding: 0;</span><br><span class="line">      width: 15em;</span><br><span class="line">    &#125;</span><br><span class="line">    .heroes li &#123;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      position: relative;</span><br><span class="line">      left: 0;</span><br><span class="line">      background-color: #EEE;</span><br><span class="line">      margin: .5em;</span><br><span class="line">      padding: .3em 0;</span><br><span class="line">      height: 1.6em;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">    &#125;</span><br><span class="line">    .heroes li.selected:hover &#123;</span><br><span class="line">      background-color: #BBD8DC !important;</span><br><span class="line">      color: white;</span><br><span class="line">    &#125;</span><br><span class="line">    .heroes li:hover &#123;</span><br><span class="line">      color: #607D8B;</span><br><span class="line">      background-color: #DDD;</span><br><span class="line">      left: .1em;</span><br><span class="line">    &#125;</span><br><span class="line">    .heroes .text &#123;</span><br><span class="line">      position: relative;</span><br><span class="line">      top: -3px;</span><br><span class="line">    &#125;</span><br><span class="line">    .heroes .badge &#123;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      font-size: small;</span><br><span class="line">      color: white;</span><br><span class="line">      padding: 0.8em 0.7em 0 0.7em;</span><br><span class="line">      background-color: #607D8B;</span><br><span class="line">      line-height: 1em;</span><br><span class="line">      position: relative;</span><br><span class="line">      left: -1px;</span><br><span class="line">      top: -4px;</span><br><span class="line">      height: 1.8em;</span><br><span class="line">      margin-right: .8em;</span><br><span class="line">      border-radius: 4px 0 0 4px;</span><br><span class="line">    &#125;</span><br><span class="line">  `]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  title = &apos;Tour of Heroes&apos;;</span><br><span class="line">  heroes = HEROES;</span><br><span class="line">  selectedHero: Hero;</span><br><span class="line">  onSelect(hero: Hero) &#123; this.selectedHero = hero; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章小结:</p><ul><li>我们现在可以选择列表里的英雄了</li><li>应用由了选择并展示英雄详情的功能</li><li>我们学习了怎么在组件模板里使用内置指令<code>ngIf</code>和<code>ngFor</code></li></ul><p>现在英雄之旅初具雏形,但还远远没有完成,我们不能使用单个组件来实现整个app,需要将组件分成若干个子组件,并将他们有效的组合起来.</p><h1 id="多组件"><a href="#多组件" class="headerlink" title="多组件"></a>多组件</h1><blockquote><p>重构master/detail视图到分离的组件</p></blockquote><h2 id="构建一个英雄详情组件"><a href="#构建一个英雄详情组件" class="headerlink" title="构建一个英雄详情组件"></a>构建一个英雄详情组件</h2><p>我们的英雄列表和我们的英雄详情目前处于一个文件里.他们现在虽然很小但是不利于扩展.我们目前的组件设计遵守单一组件原则,虽然这只是个教程,但精益求精依然是要追求的,尤其是使用Angular是非常容易做到这一点的.</p><p>让我们将英雄详情移出目前组件</p><h3 id="分离英雄详情组件"><a href="#分离英雄详情组件" class="headerlink" title="分离英雄详情组件"></a>分离英雄详情组件</h3><p><code>app</code>文件夹里增加一个新的文件<code>hero-detail.component.ts</code>,并创建如下的<code>HeroDetailComponent</code>:</p><p><em>app/hero-detail.component.ts (initial version)</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; component. Input &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@component(&#123;</span><br><span class="line">    selector: &apos;my-hero-detail&apos;,</span><br><span class="line">&#125;)</span><br><span class="line">export class HeroDetailComponent&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>命名规则<br>我们希望通过文件名可以知道对应的组件名.所有组件的文件后缀名已<code>.component</code>结尾.如<code>HeroDetailComponent</code>对应的文件名为<code>hero-detail.component.ts</code>.</p></blockquote><h3 id="英雄详情模板"><a href="#英雄详情模板" class="headerlink" title="英雄详情模板"></a>英雄详情模板</h3><p>现在,<code>Heroes</code>和<code>Hero</code>详情视图还在<code>AppComponent</code>的模板里.让我们英雄详情相关的内容黏贴到<code>HeroDetailComponent</code>里.</p><p>我们之前绑定了<code>AppComponent</code>的<code>selectedHero.name</code>特性.在新的模板中将<code>selectedHero</code>替换为<code>hero</code>.</p><p><em>app/hero-detail.component.ts (template)</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">template: `</span><br><span class="line">  &lt;div *ngIf=&quot;hero&quot;&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">    &lt;div&gt;&lt;label&gt;id: &lt;/label&gt;&#123;&#123;hero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">      &lt;input [(ngModel)]=&quot;hero.name&quot; placeholder=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p>现在英雄详情展示只会在<code>HeroDetailComponent</code>里.</p><h3 id="增加hero特性"><a href="#增加hero特性" class="headerlink" title="增加hero特性"></a>增加<code>hero</code>特性</h3><p>将<code>Hero</code>类从<code>app.component.ts</code>移出,创建并放入一个<code>hero.ts</code>文件里.</p><p><em>app/hero.ts</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export class Hero &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们将<code>Hero</code>类从<code>hero.ts</code>暴露出来,因为我们需要在多个地方引用它.在<code>app.component.ts</code>和<code>hero-detail.component.ts</code>增加以下的语句引用<code>Hero</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Hero &#125; from &apos;./hero&apos;;</span><br></pre></td></tr></table></figure><h3 id="hero特性是输入"><a href="#hero特性是输入" class="headerlink" title="hero特性是输入"></a><code>hero</code>特性是输入</h3><p><code>HeroDetailComponent</code>需要被告之哪个英雄需要显示,谁可以干这个事?它的父组件<code>AppComponent</code>!</p><p><code>AppComponent</code>知道哪个英雄需要显示:就是用户从列表里选择的那个.用户选择被放入<code>selectedHero</code>特性.</p><p>我们更新模板,将<code>HeroDetailComponent</code>的<code>hero</code>特性和<code>AppComponent</code>的<code>selectedHero</code>绑定.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;my-hero-detail [hero]=&quot;selectedHero&quot;&gt;&lt;/my-hero-detail&gt;</span><br></pre></td></tr></table></figure><p>注意到<code>hero</code>特性是特性绑定的目标-它在方括号里并处于(=)号的左边.</p><p>Angular主张将目标特性作为一个可输入的特性,如果不这样做,Angular就会拒绝绑定并抛出异常.</p><blockquote><p>input特性的详情请看<a href="https://angular.io/docs/ts/latest/guide/attribute-directives.html#why-input" target="_blank" rel="noopener">这里</a>.</p></blockquote><p>有若干方法可以声明<code>hero</code>是一个<em>输入</em>特性.我们可以按选择,比如在<code>hero</code>特性里加一个<code>@Input</code>注释.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Input()</span><br><span class="line">hero: Hero;</span><br></pre></td></tr></table></figure><blockquote><p>更多关于<code>@Input</code>装饰器内容查看<a href="https://angular.io/docs/ts/latest/guide/attribute-directives.html#input" target="_blank" rel="noopener">属性指令</a>章节.</p></blockquote><h2 id="更新AppComponent"><a href="#更新AppComponent" class="headerlink" title="更新AppComponent"></a>更新AppComponent</h2><p><code>AppComponent</code>里导入<code>HeroDetailComponent</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; HeroDetailComponent &#125; from &apos;./hero-detail.component&apos;;</span><br></pre></td></tr></table></figure><p>在模板中找到移除<code>Hero Detail</code>内容的地方,增加一个表示<code>HeroDetailComponent</code>的元素标签,并将<code>AppComponent</code>的<code>selectedHero</code>特性和<code>HeroDetailComponent</code>的<code>hero</code>特性进行双向绑定.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;my-hero-detail [hero]=&quot;selcetedHero&quot;&gt;&lt;/my-hero-detail&gt;</span><br></pre></td></tr></table></figure><p>此时AppComponent模板如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">template: `</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;My Heroes&lt;/h2&gt;</span><br><span class="line">  &lt;ul class=&quot;heroes&quot;&gt;</span><br><span class="line">    &lt;li *ngFor=&quot;let hero of heroes&quot;</span><br><span class="line">      [class.selected]=&quot;hero === selectedHero&quot;</span><br><span class="line">      (click)=&quot;onSelect(hero)&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;my-hero-detail [hero]=&quot;selectedHero&quot;&gt;&lt;/my-hero-detail&gt;</span><br><span class="line">`,</span><br></pre></td></tr></table></figure><p><code>HeroDetailComponent</code> 可以接收<code>AppComponent</code>的选择事件,并在list底部将这个英雄的详情展示出来,这个详情会随着用户的选择而改变.但是!现在什么也没有发生!我们在英雄之间来回点击,但没有详情显示,我们也没有调试到任何的错误信息.</p><p>这有点像是Angular忽略了这个新的标签,事实上确实如此.</p><h3 id="指令数组"><a href="#指令数组" class="headerlink" title="指令数组"></a>指令数组</h3><p>浏览器会忽略它不识别的HTML标签和属性,Angular也是如此.我们导入<code>HeroDetailComponent</code>,在模板里使用它,但并没有告诉Angular它是什么.<br>如何告诉Angular?将组件列入元数据<code>directives</code>数组:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directives: [HeroDetailComponent]</span><br></pre></td></tr></table></figure><p>现在功能实现了,我们也创建了第一个可复用的组件!</p><h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><p>本章小结</p><ul><li>我们创建了一个可复用的组件</li><li>我们学习了如何让组件接收输入信息</li><li>我们学习了绑定父组件和子组件</li><li>我们学习了如何声明应用指令</li></ul><h2 id="未来之路-1"><a href="#未来之路-1" class="headerlink" title="未来之路"></a>未来之路</h2><p>我们的英雄之旅将会有可多可复用的组件.我们现在模拟数据依然处于<code>AppComponent</code>中,这并不合理.我们需要重构数据接入组件,将它放到分离的服务里,可被其他组件共享.</p><p>下一章,我们将学习如何创建Services.</p><h1 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h1><blockquote><p>我们创建一个可复用的service来管理英雄数据的调用</p></blockquote><p>英雄之旅在逐步进化,可以预料以后将会增加更多的组件.多个组件需要获取英雄数据信息,我们并不想通过重复拷贝相同的代码来实现它.所以,我们将要创建一个可复用的数据服务,并学习怎么将它注入到组件里.</p><p>重构数据获取方式将它放入到分离的服务里,可以保持组件只关注它的视图,也可以使用模拟服务使得组件的单元测试更加方便.</p><p>因为数据services始终是异步的,本章最后我们将用基于<code>Promise</code>机制来实现数据服务.</p><h2 id="创建一个英雄Service"><a href="#创建一个英雄Service" class="headerlink" title="创建一个英雄Service"></a>创建一个英雄Service</h2><p>我们的合伙人说我们的这个APP有巨大的潜力,他们告诉我们他们想通过各种方法在不同的页面像是英雄信息.我们已经可以从列表里选择英雄,我们马上就需要增加一个仪表板来展示顶尖的英雄们,创建一个单独的视图来渲染英雄详情编辑界面,这三个视图都需要英雄数据.</p><p><code>AppComponent</code>里定义了要展示的英雄模拟数据.我们需要至少2个对象.首先,如何定义英雄并不是组件完成的.其次,我们并不能简单的再其他组件和视图之间分享英雄列表.</p><h3 id="创建一个HeroService"><a href="#创建一个HeroService" class="headerlink" title="创建一个HeroService"></a>创建一个HeroService</h3><p><code>app</code>文件夹里创建一个名为<code>hero.service.ts</code>.</p><p><em>app/hero.service.ts</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Injectable &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class HeroService &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们将Angualr的<code>Injectable</code>功能导入了,使用<code>@Injectable()</code>注释注入Services.</p><blockquote><p>千万不要忘了<code>()</code>!否则很难诊断问题.</p></blockquote><h3 id="获取Heros"><a href="#获取Heros" class="headerlink" title="获取Heros"></a>获取Heros</h3><p>增加一个<code>getHeroes</code>方法(打桩):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Injectable()</span><br><span class="line">export class HeroService &#123;</span><br><span class="line">  getHeroes() &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里有个重要的问题我们稍后再说.现在服务的消费者并不知道服务是如何获取到数据的.我们的<code>HeroService</code>可以从任何地方获取<code>Hero</code>数据.它可以从一个web服务里获取,可以从本地存储获取,甚至可以从一个模拟数据源里获取. 这就是将数据获取从组件移除最美妙的地方,我们可以根据具体实现来变更数据实现方式.</p><h3 id="模拟英雄数据"><a href="#模拟英雄数据" class="headerlink" title="模拟英雄数据"></a>模拟英雄数据</h3><p>我们已经在<code>AppComponent</code>里模拟了<code>Hero</code>数据.它并不属于那,也不属于service这.我们将模拟数据一到它自己的文件里.</p><p>创建一个<code>mock-heroes.ts</code>文件,将模拟数据放到这里:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123;hero&#125; from &apos;./hero&apos;;</span><br><span class="line"></span><br><span class="line">export var HEROES: hero[] = [</span><br><span class="line">  &#123;id: 11, name: &apos;Mr. Nice&apos;&#125;,</span><br><span class="line">  &#123;id: 12, name: &apos;Narco&apos;&#125;,</span><br><span class="line">  &#123;id: 13, name: &apos;Bombasto&apos;&#125;,</span><br><span class="line">  &#123;id: 14, name: &apos;Celeritas&apos;&#125;,</span><br><span class="line">  &#123;id: 15, name: &apos;Magneta&apos;&#125;,</span><br><span class="line">  &#123;id: 16, name: &apos;RubberMan&apos;&#125;,</span><br><span class="line">  &#123;id: 17, name: &apos;Dynama&apos;&#125;,</span><br><span class="line">  &#123;id: 18, name: &apos;Dr IQ&apos;&#125;,</span><br><span class="line">  &#123;id: 19, name: &apos;Magma&apos;&#125;,</span><br><span class="line">  &#123;id: 20, name: &apos;Tornado&apos;&#125;  </span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>我们导出<code>HEROES</code>常量,这样就可以在其他地方使用它了,比如<code>HeroService</code>.</p><p>同时,回到<code>app.component.ts</code>,将<code>heroes</code>特性回复到未初始化状态.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroes: Hero[];</span><br></pre></td></tr></table></figure><h3 id="返回模拟英雄数据"><a href="#返回模拟英雄数据" class="headerlink" title="返回模拟英雄数据"></a>返回模拟英雄数据</h3><p>回到<code>HeroService</code>我们导入模拟数据<code>HEROES</code>并返回给<code>getHeroes</code>方法.我们的<code>HeroService</code>现在看起来是这样的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Injectable &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; HEROES &#125; from &apos;./mock-heroes&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class HeroService &#123;</span><br><span class="line">  getHeroes() &#123;</span><br><span class="line">    return HEROES;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用英雄Service"><a href="#使用英雄Service" class="headerlink" title="使用英雄Service"></a>使用英雄Service</h3><p>我们已经准备好在其他组件里使用<code>HeroSevice</code>了,从<code>AppComponent</code>开始.</p><p>首先,我们先导入它 <code>import { HeroService } from &#39;./hero.service&#39;;</code>.</p><p>导入Service后,允许我们引用它的代码.<code>AppComponent</code>是怎样获取<code>HeroService</code>实例的?</p><p><em>new一个实例吗</em>?不行!</p><p>我们可以new一个新的<code>HeroService</code>实例,如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroService = new HeroService(); // don&apos;t do this</span><br></pre></td></tr></table></figure><p>但这么做有几点不好的地方:</p><ul><li>我们的组件需要知道如何构建<code>HeroService</code>示例.如果我们改变了<code>HeroService</code>的构造函数,我们就需要找到所有使用了这个service的地方,并修改它.不利于维护和扩展.</li><li>我们每次都new一个service,当需要缓存和共享数据这些数据的时候,我们就无法满足了.</li><li>我们现在将<code>HeroService</code>锁定到了<code>AppComponent</code>,如果执行场景有变化的时候我们该怎么办呢?我们可以离线操作吗?需要对不同的模拟版本进行单元测试?这很难办到.</li></ul><p>要解决这些问题真的非常容易.那就是注入<code>HeroService</code>:</p><ol><li>我们增加一个构造器并定义一个私有特性</li><li>我们增加一个组件的<code>provider</code>元数据.</li></ol><p>构造器如下:</p><p><em>app/app.component.ts</em><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">constructor(private heroService: HeroService) &#123; &#125;</span><br></pre></td></tr></table></figure><p></p><p>构造器并没有干什么,参数同时定义了一个私有的<code>heroService</code>属性并指定它未<code>HeroService</code>的注入站点.</p><p>现在当构建一个新的<code>AppComponent</code>的时候,Angular就可以支持<code>HeroService</code>的实例构建了.</p><blockquote><p>更多信息,请查看<a href="https://angular.io/docs/ts/latest/guide/dependency-injection.html" target="_blank" rel="noopener">依赖注入</a>章节.</p></blockquote><p>注入器并不知道怎么创建<code>HeroService</code>.如果我们执行代码.此时Angualr会报错:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXCEPTION: No provider for HeroService! (AppComponent -&gt; HeroService)</span><br></pre></td></tr></table></figure><p>我们需要通过注册一个<code>HeroService</code>的容器来告诉<em>注入器</em>如何构建<code>HeroService</code>.如下,在<code>@Component</code>里增加一个<code>providers</code>数组属性.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">providers: [HeroService]</span><br></pre></td></tr></table></figure><p><code>providers</code>数组告诉Angular,当构建一个新的<code>AppComponent</code>的时候就会创建一个新的<code>HeroService</code>实例.<code>AppComponent</code>以及它的子组件都可以使用这个service去获取英雄数据.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getHeroes() &#123;</span><br><span class="line">   this.heroes = this.heroService.getHeroes();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="ngOnInit生命周期Hook"><a href="#ngOnInit生命周期Hook" class="headerlink" title="ngOnInit生命周期Hook"></a>ngOnInit生命周期Hook</h3><p><code>AppComponent</code>应该立即获取和展示英雄们,我们在哪里调用<code>getHeroes</code>方法?在构造器里?我们不这样做!</p><p>数年挖坑填坑之痛告诉我们,要保持构造器的逻辑尽量简单,尤其当我们还需要调用server的data数据的时候.</p><p>构造器用于一些简单的初始化工作,比如讲参数写入属性里,并不适合做太重的活,所以需要在其他地方调用<code>getHeroes</code>.</p><p>Angular将会在ngOnInit生命周期Hook里调用这个<code>getHeroes</code>. Angular 提供了数个接口可以进入组件生命周期的关键节点:创建,改变后,消除.</p><p>每一个接口对用一个单独的方法,当组件应用了这个方法,Angular会在合适的时间调用他.</p><blockquote><p>关于生命周期详细内容请查看<a href="https://angular.io/docs/ts/latest/guide/lifecycle-hooks.html" target="_blank" rel="noopener">生命周期Hook</a>章节</p></blockquote><p>以下是<code>OnInit</code>接口的基本应用框架:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们在<code>ngOnInit</code>里写入符合该逻辑的方法,Angualr会在合适的地方调用它.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ngOnInit() &#123;</span><br><span class="line">  this.getHeroes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们的应用如我们期望运行,显示了一组英雄列表,当我们选择点击的时候,可以查看该英雄的详情.</p><h2 id="异步服务和Promises"><a href="#异步服务和Promises" class="headerlink" title="异步服务和Promises"></a>异步服务和Promises</h2><p>我们的<code>HeroService</code>会立即返回一组模拟的英雄,<code>getHeroes</code>是同步的.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.heroes = this.heroService.getHeroes();</span><br></pre></td></tr></table></figure><p>当某天我们想从远程服务器获取heroes的时候,虽然我们现在还不能通过<code>http</code>调用,但后面的章节我们马上就要这样了.我们将不得不等待服务器的响应信息,我们不能让UI跟着等待,因为浏览器是不会堵塞的.</p><p>我们就需要一些一步技术来调用<code>getHeroes</code>方法.我们使用<code>Promises</code>.</p><p><code>Promise</code>就是说它保证会结果准备好的时候回调我们.我们给服务器发了一个异步请求并将回调函数告诉它.当请求有结果的时候,服务器会回调告诉我们结果.</p><p>更新<code>HeroService</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getHeroes() &#123;</span><br><span class="line">  return Promise.resolve(HEROES);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用Promise"><a href="#使用Promise" class="headerlink" title="使用Promise"></a>使用Promise</h3><p>回到<code>AppComponent</code>的<code>getHeroes</code>方法,目前代码如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getHeroes() &#123;</span><br><span class="line">  this.heroes = this.heroService.getHeroes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要修改代码来解析<code>Promise</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getHeroes() &#123;</span><br><span class="line">  this.heroService.getHeroes().then(heroes =&gt; this.heroes = heroes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查看APP结构"><a href="#查看APP结构" class="headerlink" title="查看APP结构"></a>查看APP结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">--angular2-tour-of-heroes</span><br><span class="line"></span><br><span class="line">----app</span><br><span class="line"></span><br><span class="line">------app.component.ts</span><br><span class="line"></span><br><span class="line">------hero.ts</span><br><span class="line"></span><br><span class="line">------hero-detail.component.ts</span><br><span class="line"></span><br><span class="line">------hero.service.ts</span><br><span class="line"></span><br><span class="line">------main.ts</span><br><span class="line"></span><br><span class="line">------mock-heroes.ts</span><br><span class="line"></span><br><span class="line">----node_modules ...</span><br><span class="line"></span><br><span class="line">----typings ...</span><br><span class="line"></span><br><span class="line">----index.html</span><br><span class="line"></span><br><span class="line">----package.json</span><br><span class="line"></span><br><span class="line">----styles.css</span><br><span class="line"></span><br><span class="line">----systemjs.config.js</span><br><span class="line"></span><br><span class="line">----tsconfig.json</span><br><span class="line"></span><br><span class="line">----typings.json</span><br></pre></td></tr></table></figure><h2 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h2><p>本章小结</p><ul><li>我们创建了一个可分享的服务类</li><li>我们使用<code>ngOnInit</code>生命周期的挂钩来获取英雄数据列表</li><li>我们在<code>AppComponent</code>里将<code>HeroService</code>定义为一个<code>provider</code></li><li>我们创建模拟英雄数据并将它导入服务.</li><li>我们将服务设计为异步Promise,让组件从Promise里解析获取数据.</li></ul><h2 id="下一章"><a href="#下一章" class="headerlink" title="下一章"></a>下一章</h2><p>我们的英雄之旅代码现在有了可复用的服务,我们现在想创建一个导航栏,可以在仪表盘和英雄详情编辑页里来回切换.</p><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>英雄之旅的新需求:</p><ul><li>增加一个<code>Dashboard</code>视图</li><li>可以在<code>Heroes</code>和<code>Dashboard</code>视图来回切换</li><li>点击选择英雄可以跳转到英雄详情</li></ul><p><img src="/res/img/angularjs2/nav-diagram.png" alt=""></p><h2 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h2><ul><li>将<code>AppComponent</code>变为处理导航的外壳.</li><li>将<code>Heroes</code>相关内容从<code>AppComponent</code>重定向<code>HeroesComponent</code>.</li><li>增加路由</li><li>创建一个<code>DashboardComponent</code></li><li>将<em>Dashboard</em>绑定到导航结构.</li></ul><h2 id="重组AppComponent"><a href="#重组AppComponent" class="headerlink" title="重组AppComponent"></a>重组AppComponent</h2><p>我们当前应用加载<code>AppComponent</code>并立即展示英雄列表.现在我们先进入导航界面. <code>AppComponent</code>应该只处理导航,将英雄显示相关部分移到它自己的组件<code>HeroesComponent</code>.</p><h3 id="HerosComponent"><a href="#HerosComponent" class="headerlink" title="HerosComponent"></a>HerosComponent</h3><p>目前的<code>AppComponent</code>主要专注于英雄展示,将其改名未<code>HerosComponent</code>,改名步骤如下:</p><ul><li><code>app.component.ts</code>改为<code>heroes.component.ts</code></li><li><code>AppComponent</code>类改名为<code>HeroesComponent</code></li><li>选择器<code>my-app</code>改为<code>my-heroes</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-heroes&apos;,</span><br><span class="line">&#125;)</span><br><span class="line">export class HeroesComponent implements OnInit &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="创建AppComponent"><a href="#创建AppComponent" class="headerlink" title="创建AppComponent"></a>创建AppComponent</h2><ul><li>创建一个新文件名<code>app.component.ts</code></li><li>定义一个<code>AppComponent</code>类</li><li>导出模块以便可在<code>main.ts</code>引用</li><li>定义<code>title</code>属性</li><li>增加一个有<code>my-app</code>选择器的<code>@Component</code>元数据装饰器</li><li>增加一个有<code>&lt;h1&gt;</code>标签的模板并绑定到<code>title</code>属性</li><li>模板里增加<code>&lt;my-heroes&gt;</code>标签用于显示英雄</li><li>将<code>HeroesComponent</code>放入<code>directives</code>数组,这样Angluar就可以识别<code>&lt;my-heroes&gt;</code>标签了.</li><li>增加<code>HeroService</code>到<code>providers</code>数组,因为我们在其他视图中也需要它.</li><li>增加支持<code>import</code>语句.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125;       from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HeroService &#125;     from &apos;./hero.service&apos;;</span><br><span class="line">import &#123; HeroesComponent &#125; from &apos;./heroes.component&apos;;</span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;my-heroes&gt;&lt;/my-heroes&gt;</span><br><span class="line">  `,</span><br><span class="line">  directives: [HeroesComponent],</span><br><span class="line">  providers: [</span><br><span class="line">    HeroService</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  title = &apos;Tour of Heroes&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个app依然可以显示英雄,我们的重构工作就完成了.</p><h2 id="增加路由"><a href="#增加路由" class="headerlink" title="增加路由"></a>增加路由</h2><p>我们准备进行下一步.和自动展示英雄相比,我们更喜欢点击展示的方式,换句话说,我们想当行到英雄列表.这个时候我们就需要Angular的组件路由功能.</p><h3 id="设置基础标签"><a href="#设置基础标签" class="headerlink" title="设置基础标签"></a>设置基础标签</h3><p>打开<code>index.html</code>在顶部的<code>&lt;head&gt;</code>部分增加<code>&lt;base href=&quot;/&quot;&gt;</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;base href=&quot;/&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="使路由可见"><a href="#使路由可见" class="headerlink" title="使路由可见"></a>使路由可见</h3><p><em>组件路由器</em>是一个服务,和其他服务一样,我们需要先导入它,并将它让入<code>providers</code>数组.</p><p>Angular路由是有由多服务(<code>ROUTER_PROVIDERS</code>),多指令(<code>ROUTER_DIRECTIVES</code>)和一个配置装饰器(<code>RouteConfig</code>)组成,将他们全部导入:</p><p><em>app/app.component.ts</em><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; RouteConfig, ROUTER_DIRECTIVES, ROUTER_PROVIDERS &#125; from &apos;@angular/router-deprecated&apos;;</span><br></pre></td></tr></table></figure><p></p><p>然后,我们升级<code>directives</code>和<code>providers</code>元数组,让组件包含这些路由成分:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">directives: [ROUTER_DIRECTIVES],</span><br><span class="line">providers: [</span><br><span class="line">  ROUTER_PROVIDERS,</span><br><span class="line">  HeroService</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>注意到我们将<code>HeroesComponent</code>从<code>directives</code>数组移除了.<code>AppComponent</code>不再显示英雄;这是路由器的工作,我们很快也会把<code>&lt;my-heroes&gt;</code>从模板移除.</p><h3 id="增加配置路由器"><a href="#增加配置路由器" class="headerlink" title="增加配置路由器"></a>增加配置路由器</h3><p>现在<code>AppComponent</code>还没有包括路由器,我们现在使用<code>@RouteConfig</code>装饰器(a)给组件分配一个路由器(b)使用<em>routes</em>配置路由器.</p><p>当用户点击某个连接或者在浏览器输入<code>URL</code>的时候,<em>routes</em>告诉路由器哪个视图是应该对应显示的.</p><p><em>app/app.component.ts (RouteConfig):</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RouteConfig([</span><br><span class="line">  &#123;</span><br><span class="line">    path: &apos;/heroes&apos;,</span><br><span class="line">    name: &apos;Heroes&apos;,</span><br><span class="line">    component: HeroesComponent</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p><code>@RouteConfig</code> 数组定义了路由,之后会有更多的路由.</p><p>这个路由定义只要有三个部分:</p><ul><li>path: 路由器对浏览器里URL的路径进行匹配(<code>/heroes</code>).</li><li>name: 路由的正式命名;为了和路径区分,命名必须首字母大写.</li><li>component: 路由对应的组件名字</li></ul><blockquote><p>深入请翻阅<a href="https://angular.io/docs/ts/latest/guide/router-deprecated.html" target="_blank" rel="noopener"><code>Routing</code></a>章节</p></blockquote><h3 id="路由器出口"><a href="#路由器出口" class="headerlink" title="路由器出口"></a>路由器出口</h3><p>如果我们在浏览器输入<code>/heroes</code>对应地址,路由器会匹配<code>Heroes</code>路由并渲染<code>HeroesComponent</code>组件.但在哪里显示?<code>&lt;router-outlet&gt;</code>!我们在应用里导航,路由器会将对应组件显示到<code>&lt;router-outlet&gt;</code>之下.</p><h3 id="路由器链接"><a href="#路由器链接" class="headerlink" title="路由器链接"></a>路由器链接</h3><p>我们并不期望用户直接粘贴URL到浏览器地址栏,我们在模板里增加一个锚标签供用户点击.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">template: `</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;a [routerLink]=&quot;[&apos;Heroes&apos;]&quot;&gt;Heroes&lt;/a&gt;</span><br><span class="line">  &lt;router-outlet&gt;&lt;/router-outlet&gt;</span><br><span class="line">`,</span><br></pre></td></tr></table></figure><p>注意到<code>[routerLink]</code>绑定到一个锚标签上.我们将<code>RouterLink</code>指令绑定一个路由,当用户点击链接的时候就知道导航的位置.</p><p>我们使用<code>链接参数数组</code>定义了<code>路由指示</code>,这个数组在当前示例中,显示一个元素,括号内是路由到组件<code>HeroesComponent</code>的名字<code>Heroes</code>.</p><blockquote><p>更多关于链接数组相关内容请查看<code>路由</code>章节.</p></blockquote><p>刷新浏览器,我们只看到app的title,并没有看到heroes列表,当我们点击<code>Heroes</code>导航链接就发现了英雄列表.</p><p><em>app/app.component.ts (v2)</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; RouteConfig, ROUTER_DIRECTIVES, ROUTER_PROVIDERS &#125; from &apos;@angular/router-deprecated&apos;;</span><br><span class="line">import &#123; HeroService &#125;     from &apos;./hero.service&apos;;</span><br><span class="line">import &#123; HeroesComponent &#125; from &apos;./heroes.component&apos;;</span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;a [routerLink]=&quot;[&apos;Heroes&apos;]&quot;&gt;Heroes&lt;/a&gt;</span><br><span class="line">    &lt;router-outlet&gt;&lt;/router-outlet&gt;</span><br><span class="line">  `,</span><br><span class="line">  directives: [ROUTER_DIRECTIVES],</span><br><span class="line">  providers: [</span><br><span class="line">    ROUTER_PROVIDERS,</span><br><span class="line">    HeroService</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line">@RouteConfig([</span><br><span class="line">  &#123;</span><br><span class="line">    path: &apos;/heroes&apos;,</span><br><span class="line">    name: &apos;Heroes&apos;,</span><br><span class="line">    component: HeroesComponent</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  title = &apos;Tour of Heroes&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>AppComponent</em>现在关联到了路由器并显示路由的视图.基于这些功能有别于其他组件,我们称这类组件为<em>路由器组件</em>.</p><h2 id="增加一个仪表盘"><a href="#增加一个仪表盘" class="headerlink" title="增加一个仪表盘"></a>增加一个仪表盘</h2><p>当我们有多个视图的时候,路由才有意义.我们需要另外一个视图.</p><p><em>app/dashboard.component.ts (v1)</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-dashboard&apos;,</span><br><span class="line">  template: &apos;&lt;h3&gt;My Dashboard&lt;/h3&gt;&apos;</span><br><span class="line">&#125;)</span><br><span class="line">export class DashboardComponent &#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="配置dashboard路由"><a href="#配置dashboard路由" class="headerlink" title="配置dashboard路由"></a>配置dashboard路由</h3><p>回到<code>app.component.ts</code>配置导航到dashboard的路由.</p><p>导入<code>DashboardComponent</code>,在<code>@RouteConfig</code>里定义<code>Dashboard</code>路由.</p><p><em>app/app.component.ts</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &apos;/dashboard&apos;,</span><br><span class="line">  name: &apos;Dashboard&apos;,</span><br><span class="line">  component: DashboardComponent,</span><br><span class="line">  useAsDefault: true</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>最后,增加一个导航链接到模板里:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">template: `</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;nav&gt;</span><br><span class="line">    &lt;a [routerLink]=&quot;[&apos;Dashboard&apos;]&quot;&gt;Dashboard&lt;/a&gt;</span><br><span class="line">    &lt;a [routerLink]=&quot;[&apos;Heroes&apos;]&quot;&gt;Heroes&lt;/a&gt;</span><br><span class="line">  &lt;/nav&gt;</span><br><span class="line">  &lt;router-outlet&gt;&lt;/router-outlet&gt;</span><br><span class="line">`,</span><br></pre></td></tr></table></figure><p>刷新浏览器,我们可以在dashboard和heroes之间来回切换了.</p><h2 id="Dashboard顶级英雄"><a href="#Dashboard顶级英雄" class="headerlink" title="Dashboard顶级英雄"></a>Dashboard顶级英雄</h2><p>让我们用4个顶级英雄来填充dashboard.将template元数据用templateUrl替换:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app/dashboard.component.ts (templateUrl)</span><br><span class="line"></span><br><span class="line">templateUrl: &apos;app/dashboard.component.html&apos;,</span><br></pre></td></tr></table></figure><blockquote><p>我们使用了全路径,这是因为Angular默认不支持相对路径,具体可以查看<a href="https://angular.io/docs/ts/latest/cookbook/component-relative-paths.html" target="_blank" rel="noopener">组件相对路径</a>.</p></blockquote><p>创建文件app/dashboard.component.html,内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;Top Heroes&lt;/h3&gt;</span><br><span class="line">&lt;div class=&quot;grid grid-pad&quot;&gt;</span><br><span class="line">  &lt;div *ngFor=&quot;let hero of heroes&quot; (click)=&quot;gotoDetail(hero)&quot; class=&quot;col-1-4&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;module hero&quot;&gt;</span><br><span class="line">      &lt;h4&gt;&#123;&#123;hero.name&#125;&#125;&lt;/h4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>我们使用<code>*ngFor</code>来遍历英雄列表并展示英雄名字,我们增加一个额外的<code>&lt;div&gt;</code>元素用于后面进行样式化.</p><p>在这里有个<code>(click)</code>绑定到<code>gotoDetail</code>方法上,这个方法我们现在还没有.</p><h3 id="共享HeroService"><a href="#共享HeroService" class="headerlink" title="共享HeroService"></a>共享HeroService</h3><p>我们复用HeroService来获取组件的英雄数组.回顾之前的章节,我们HeroService从HeroesComponent的providers数组移到了最高级的AppComponent组件上.这样就使得HeroService成为一个单例,对所有的应用组件生效.Angular将会注入HeroService,我们就可以在DashboardComponent里使用它.</p><h3 id="获取heroes"><a href="#获取heroes" class="headerlink" title="获取heroes"></a>获取heroes</h3><p>打开dashboard.component.ts,代码如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Hero &#125; from &apos;./hero&apos;;</span><br><span class="line">import &#123; HeroService &#125; from &apos;./hero.service&apos;;</span><br><span class="line"></span><br><span class="line">export class DashboardComponent implements OnInit &#123;</span><br><span class="line">  heroes: Hero[] = [];</span><br><span class="line">  constructor(private heroService: HeroService) &#123; &#125;</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.heroService.getHeroes()</span><br><span class="line">      .then(heroes =&gt; this.heroes = heroes.slice(1, 5));</span><br><span class="line">  &#125;</span><br><span class="line">  gotoDetail() &#123; /* not implemented yet */&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>和创建HerosComponent类似,在这里我们创建一个heroes数组属性,注入HeroService并将他保存在私有字段heroService里,然后在Angular的ngOnInit生命周期里调用这个服务.</p><p>不同的是:我们使用slice挑选了4个英雄(2-5),并将gotoDetail方法打桩,刷新浏览器,我们现在可以看到4个英雄.</p><h2 id="导航到英雄详情"><a href="#导航到英雄详情" class="headerlink" title="导航到英雄详情"></a>导航到英雄详情</h2><p>虽然我们在HeroesComponent底部现实了选择英雄的详情,蛋我们还不能满足以下几种导航需求:</p><pre><code>1. 在Dashboard选择英雄
2. 在英雄列表选择英雄
3. 浏览器里输入完成的URl来显示英雄
</code></pre><p>增加一个HeroDetail路由显然是个好的选择.</p><h3 id="路由到英雄详情"><a href="#路由到英雄详情" class="headerlink" title="路由到英雄详情"></a>路由到英雄详情</h3><p>我们在AppComponent增加一个到HeroDetailComponent的路由.这个路由不同的地方是需要给它指定具体的英雄,这和HeroesComponent,DashboardComponent不同,后者不需要传给他们任何参数.</p><p>现在,父组件HeroesComponent将hero属性绑定到一个英雄对象:</p><p><code>&lt;my-hero-detail [hero]=&quot;selectedHero&quot;&gt;&lt;/my-hero-detail&gt;</code></p><p>当前的代码还无法正常运行,我们还需要做如下的工作.</p><h3 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h3><p>我们可以在URL里增加一个英雄的id,比如路由到一个id是11的英雄,其URL为如下所示:</p><p><code>/detail/11</code></p><p>URL的/detail/部分是常量,尾部的数字id根据英雄不同而变化,我们需要配置路由并使用一个变量来便表示它.配置路由参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &apos;/detail/:id&apos;,</span><br><span class="line">  name: &apos;HeroDetail&apos;,</span><br><span class="line">  component: HeroDetailComponent</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>路径中的冒号(:)是占位文字,当导航到HeroDetailComponent时用于填充对应的英雄id.现在HeroDetaiComponent代码如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, Input &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Hero &#125; from &apos;./hero&apos;;</span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-hero-detail&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;div *ngIf=&quot;hero&quot;&gt;</span><br><span class="line">      &lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;id: &lt;/label&gt;&#123;&#123;hero.id&#125;&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">        &lt;input [(ngModel)]=&quot;hero.name&quot; placeholder=&quot;name&quot;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class HeroDetailComponent &#123;</span><br><span class="line">  @Input() hero: Hero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模板不需要改变,我们以同样的方式显示英雄,但获取英雄的方式变化了.我们现在不从父组件的属性绑定中获取英雄.HeroDetailComponent现在需要从路由器的RouteParams service获得id,并使用这个id从HeroService里获取hero数据.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; RouteParams &#125; from &apos;@angular/router-deprecated&apos;;</span><br><span class="line">import &#123; HeroService &#125; from &apos;./hero.service&apos;;</span><br><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br></pre></td></tr></table></figure><p>注入RouteParams和HeroService服务:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">constructor(</span><br><span class="line">  private heroService: HeroService,</span><br><span class="line">  private routeParams: RouteParams) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在ngOnInit生命挂钩中,从RouteParams获取id参数,并从HeroService获取英雄</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ngOnInit() &#123;</span><br><span class="line">  let id = +this.routeParams.get(&apos;id&apos;);</span><br><span class="line">  this.heroService.getHero(id)</span><br><span class="line">    .then(hero =&gt; this.hero = hero);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意到我们调用RouteParams.get来或得id</p><p><code>let id = +this.routeParams.get(&#39;id&#39;);</code></p><p>由于英雄的id是一个数字,而Route得参数都是字符串,所以用JavaScript(+)进行数值转换.</p><h3 id="增加HeroService-getHero"><a href="#增加HeroService-getHero" class="headerlink" title="增加HeroService.getHero"></a>增加HeroService.getHero</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getHero(id: number) &#123;</span><br><span class="line">  return this.getHeroes()</span><br><span class="line">             .then(heroes =&gt; heroes.filter(hero =&gt; hero.id === id)[0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="返回"><a href="#返回" class="headerlink" title="返回"></a>返回</h3><p>用户通过选择点击或者URL输入跳转到HeroDetailComponent视图界面后,可以选择返回:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">goBack() &#123;</span><br><span class="line">  window.history.back();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在对应模板增加返回点击事件绑定:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div *ngIf=&quot;hero&quot;&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;hero.name&#125;&#125; details!&lt;/h2&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;id: &lt;/label&gt;&#123;&#123;hero.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;name: &lt;/label&gt;</span><br><span class="line">    &lt;input [(ngModel)]=&quot;hero.name&quot; placeholder=&quot;name&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button (click)=&quot;goBack()&quot;&gt;Back&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>最后,我们的HeroDettailComponent如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; RouteParams &#125; from &apos;@angular/router-deprecated&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Hero &#125; from &apos;./hero&apos;;</span><br><span class="line">import &#123; HeroService &#125; from &apos;./hero.service&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-hero-detail&apos;,</span><br><span class="line">  templateUrl: &apos;app/hero-detail.component.html&apos;,</span><br><span class="line">&#125;)</span><br><span class="line">export class HeroDetailComponent implements OnInit &#123;</span><br><span class="line">  hero: Hero;</span><br><span class="line"></span><br><span class="line">  constructor(</span><br><span class="line">    private heroService: HeroService,</span><br><span class="line">    private routeParams: RouteParams) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    let id = +this.routeParams.get(&apos;id&apos;);</span><br><span class="line">    this.heroService.getHero(id)</span><br><span class="line">      .then(hero =&gt; this.hero = hero);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  goBack() &#123;</span><br><span class="line">    window.history.back();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="选择一个Dashboard英雄"><a href="#选择一个Dashboard英雄" class="headerlink" title="选择一个Dashboard英雄"></a>选择一个Dashboard英雄</h2><p>当用户从dashboard选择一个英雄,应用将会跳转到HeroDetailComponent视图,并可以编辑英雄.</p><p>在dashbaord的模板里,绑定了英雄点击事件到gotoDetail方法里,并将选择的英雄实体传入:</p><p><code>&lt;div *ngFor=&quot;let hero of heroes&quot; (click)=&quot;gotoDetail(hero)&quot; class=&quot;col-1-4&quot;&gt;</code></p><p>之前重写DashboardComponent的时候,我们还未完成gotoDetail方法,现在我们将它实现:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gotoDetail(hero:Hero) &#123;</span><br><span class="line">truelet link = [&apos;HeroDetail&apos;, &#123;id: hero.id&#125;];</span><br><span class="line">truethis.router.navigate(link);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个gotoDetail方法通过两个步骤导航:</p><pre><code>1. 设置一个路由连接参数数组
2. 将该数组传入路由器的navigate方法
</code></pre><p>link数组有两个元素,目标路由的命名以及路由参数对象,和在AppComponent中的路由配置是相对应的.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &apos;/detail/:id&apos;,</span><br><span class="line">  name: &apos;HeroDetail&apos;,</span><br><span class="line">  component: HeroDetailComponent</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>DashboardComponent还没有路由,我们将其加入:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Router &#125; from &apos;@angular/router-deprecated&apos;;</span><br><span class="line">...</span><br><span class="line">constructor(</span><br><span class="line">  private router: Router,</span><br><span class="line">  private heroService: HeroService) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HerosComponent里选择一个英雄"><a href="#HerosComponent里选择一个英雄" class="headerlink" title="HerosComponent里选择一个英雄"></a>HerosComponent里选择一个英雄</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">template: `</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;My Heroes&lt;/h2&gt;</span><br><span class="line">  &lt;ul class=&quot;heroes&quot;&gt;</span><br><span class="line">    &lt;li *ngFor=&quot;let hero of heroes&quot;</span><br><span class="line">      [class.selected]=&quot;hero === selectedHero&quot;</span><br><span class="line">      (click)=&quot;onSelect(hero)&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;badge&quot;&gt;&#123;&#123;hero.id&#125;&#125;&lt;/span&gt; &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;my-hero-detail [hero]=&quot;selectedHero&quot;&gt;&lt;/my-hero-detail&gt;</span><br><span class="line">`,</span><br></pre></td></tr></table></figure><p>删除<my-hero-detail>标签,我们不用显示完整的HeroDetailComponent了,它将显示在自己的页面上,同时当用户从列表选择一个英雄,我们将不会进入detail页面,我们先显示一个mini-detail页面,当用户再次点击这个页面的时候,才会导航到完全的详情页.</my-hero-detail></p><h3 id="增加一个mini-detail"><a href="#增加一个mini-detail" class="headerlink" title="增加一个mini-detail"></a>增加一个mini-detail</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div *ngIf=&quot;selectedHero&quot;&gt;</span><br><span class="line">  &lt;h2&gt;</span><br><span class="line">    &#123;&#123;selectedHero.name | uppercase&#125;&#125; is my hero</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;button (click)=&quot;gotoDetail()&quot;&gt;View Details&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>在点击一个英雄后,用户将会看到以下的页面:</p><p><img src="/res/img/angularjs2/mini-hero-detail.png" alt=""></p><p>注意到英雄名都是大写,这是UpperCasePipe的效果,(|)是一个管道操作符,管道擅长对格式化一些字符串,金钱符号,日期等数据.</p><blockquote><p>关于管道可以查看<a href="https://angular.io/docs/ts/latest/guide/pipes.html" target="_blank" rel="noopener">管道</a>章节</p></blockquote><p><em>将内容移除组件文件</em></p><p>我们还需要更新组件类,完成用户点击View Details按钮功能.这个组件文件越来越大,大部分是模板或者CSS样式,很难找到组件的逻辑代码,让我们稍微重构下:</p><pre><code>1. 将模板内容移动到hereos.component.html文件
2. 将样式内容移到heroes.component.css文件
3. 分别设置templateUrl和styleUrls为上述两文件
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-heroes&apos;,</span><br><span class="line">  templateUrl: &apos;app/heroes.component.html&apos;,</span><br><span class="line">  styleUrls:  [&apos;app/heroes.component.css&apos;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>现在组件的代码比较干净了,可以更清晰的看出其逻辑:</p><pre><code>1. 导入router
2. 将router注入构造器
3. 实现gotoDetail方法:调用router.navigate方法传入HeroDetail的链接参数数组.
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app/heroes.component.ts (class)</span><br><span class="line"></span><br><span class="line">export class HeroesComponent implements OnInit &#123;</span><br><span class="line">  heroes: Hero[];</span><br><span class="line">  selectedHero: Hero;</span><br><span class="line">  constructor(</span><br><span class="line">    private router: Router,</span><br><span class="line">    private heroService: HeroService) &#123; &#125;</span><br><span class="line">  getHeroes() &#123;</span><br><span class="line">    this.heroService.getHeroes().then(heroes =&gt; this.heroes = heroes);</span><br><span class="line">  &#125;</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.getHeroes();</span><br><span class="line">  &#125;</span><br><span class="line">  onSelect(hero: Hero) &#123; this.selectedHero = hero; &#125;</span><br><span class="line">  gotoDetail() &#123;</span><br><span class="line">    this.router.navigate([&apos;HeroDetail&apos;, &#123; id: this.selectedHero.id &#125;]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="App样式"><a href="#App样式" class="headerlink" title="App样式"></a>App样式</h2><p>App的功能已经完成了,但是界面还不是很美观,我们的设计师提供了一些CSS文件来优化它.</p><h3 id="Dashboard样式"><a href="#Dashboard样式" class="headerlink" title="Dashboard样式"></a>Dashboard样式</h3><p>设计师认为dashboard的英雄们用一组矩阵来显示,他们给了我们可实现响应式的大概60行CSS代码. 在aoo文件夹下面增加一个dashboard.component.css文件,并放入组件元数据styleUrls数组属性里.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">styleUrls: [&apos;app/dashboard.component.css&apos;]</span><br><span class="line"></span><br><span class="line">[class*=&apos;col-&apos;] &#123;</span><br><span class="line">  float: left;</span><br><span class="line">&#125;</span><br><span class="line">*, *:after, *:before &#123;</span><br><span class="line">    -webkit-box-sizing: border-box;</span><br><span class="line">    -moz-box-sizing: border-box;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">h3 &#123;</span><br><span class="line">  text-align: center; margin-bottom: 0;</span><br><span class="line">&#125;</span><br><span class="line">[class*=&apos;col-&apos;] &#123;</span><br><span class="line">  padding-right: 20px;</span><br><span class="line">  padding-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line">[class*=&apos;col-&apos;]:last-of-type &#123;</span><br><span class="line">  padding-right: 0;</span><br><span class="line">&#125;</span><br><span class="line">.grid &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">&#125;</span><br><span class="line">.col-1-4 &#123;</span><br><span class="line">  width: 25%;</span><br><span class="line">&#125;</span><br><span class="line">.module &#123;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    color: #eee;</span><br><span class="line">    max-height: 120px;</span><br><span class="line">    min-width: 120px;</span><br><span class="line">    background-color: #607D8B;</span><br><span class="line">    border-radius: 2px;</span><br><span class="line">&#125;</span><br><span class="line">h4 &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.module:hover &#123;</span><br><span class="line">  background-color: #EEE;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  color: #607d8b;</span><br><span class="line">&#125;</span><br><span class="line">.grid-pad &#123;</span><br><span class="line">  padding: 10px 0;</span><br><span class="line">&#125;</span><br><span class="line">.grid-pad &gt; [class*=&apos;col-&apos;]:last-of-type &#123;</span><br><span class="line">  padding-right: 20px;</span><br><span class="line">&#125;</span><br><span class="line">@media (max-width: 600px) &#123;</span><br><span class="line">    .module &#123;</span><br><span class="line">      font-size: 10px;</span><br><span class="line">      max-height: 75px; &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media (max-width: 1024px) &#123;</span><br><span class="line">    .grid &#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    .module &#123;</span><br><span class="line">      min-width: 60px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="英雄详情界面优化"><a href="#英雄详情界面优化" class="headerlink" title="英雄详情界面优化"></a>英雄详情界面优化</h3><p>app目录下增加一个hero-detail.component.css文件,内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">label &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  width: 3em;</span><br><span class="line">  margin: .5em 0;</span><br><span class="line">  color: #607D8B;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">input &#123;</span><br><span class="line">  height: 2em;</span><br><span class="line">  font-size: 1em;</span><br><span class="line">  padding-left: .4em;</span><br><span class="line">&#125;</span><br><span class="line">button &#123;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">  font-family: Arial;</span><br><span class="line">  background-color: #eee;</span><br><span class="line">  border: none;</span><br><span class="line">  padding: 5px 10px;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  cursor: pointer; cursor: hand;</span><br><span class="line">&#125;</span><br><span class="line">button:hover &#123;</span><br><span class="line">  background-color: #cfd8dc;</span><br><span class="line">&#125;</span><br><span class="line">button:disabled &#123;</span><br><span class="line">  background-color: #eee;</span><br><span class="line">  color: #ccc;</span><br><span class="line">  cursor: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="导航链接界面优化"><a href="#导航链接界面优化" class="headerlink" title="导航链接界面优化"></a>导航链接界面优化</h3><p>app目录下增加一个app.component.css文件,内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">h1 &#123;</span><br><span class="line">  font-size: 1.2em;</span><br><span class="line">  color: #999;</span><br><span class="line">  margin-bottom: 0;</span><br><span class="line">&#125;</span><br><span class="line">h2 &#123;</span><br><span class="line">  font-size: 2em;</span><br><span class="line">  margin-top: 0;</span><br><span class="line">  padding-top: 0;</span><br><span class="line">&#125;</span><br><span class="line">nav a &#123;</span><br><span class="line">  padding: 5px 10px;</span><br><span class="line">  text-decoration: none;</span><br><span class="line">  margin-top: 10px;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  background-color: #eee;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line">nav a:visited, a:link &#123;</span><br><span class="line">  color: #607D8B;</span><br><span class="line">&#125;</span><br><span class="line">nav a:hover &#123;</span><br><span class="line">  color: #039be5;</span><br><span class="line">  background-color: #CFD8DC;</span><br><span class="line">&#125;</span><br><span class="line">nav a.router-link-active &#123;</span><br><span class="line">  color: #039be5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="应用全局样式"><a href="#应用全局样式" class="headerlink" title="应用全局样式"></a>应用全局样式</h3><p>之前的样式都是组件内有效,我们也可以在应用层面上组件之外创建一个全局样式,比如设计师提供一些基础样式需要在整个应用内有效的.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">styles.css (app styles excerpt)</span><br><span class="line"></span><br><span class="line">/* Master Styles */</span><br><span class="line">h1 &#123;</span><br><span class="line">  color: #369;</span><br><span class="line">  font-family: Arial, Helvetica, sans-serif;   </span><br><span class="line">  font-size: 250%;</span><br><span class="line">&#125;</span><br><span class="line">h2, h3 &#123;</span><br><span class="line">  color: #444;</span><br><span class="line">  font-family: Arial, Helvetica, sans-serif;   </span><br><span class="line">  font-weight: lighter;</span><br><span class="line">&#125;</span><br><span class="line">body &#123;</span><br><span class="line">  margin: 2em;</span><br><span class="line">&#125;</span><br><span class="line">body, input[text], button &#123;</span><br><span class="line">  color: #888;</span><br><span class="line">  font-family: Cambria, Georgia;</span><br><span class="line">&#125;</span><br><span class="line">/* . . . */</span><br><span class="line">/* everywhere else */</span><br><span class="line">* &#123;</span><br><span class="line">  font-family: Arial, Helvetica, sans-serif;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>增加一个新的styles.css文件,并在index.html里引用它.</p><p><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;</code></p><p>现在我们的app是这个样子了.</p><p><img src="/res/img/angularjs2/dashboard-top-heroes.png" alt=""></p><h2 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h2><ul><li>我们增加了一个Angular路由组件</li><li>我们学习了如何创建导航菜单栏的路由链接.</li><li>我们使用路由参数跳转到用户选择英雄的详情页</li><li>多组件共享HeroService</li><li>分离HTML和CSS文件到各自的文件</li><li>uppercase管道来格式化数据</li></ul><h3 id="未来之路-2"><a href="#未来之路-2" class="headerlink" title="未来之路"></a>未来之路</h3><p>现在万事俱备,只欠东风了,就是远程数据接入.</p><p>下一章,我们将从一个http服务器上来获取英雄数据.</p><h1 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h1><p>我们的合伙人对我们的项目进度非常满意,现在他们想要从别的服务器获取英雄数据了,让用户可以增加,编辑,删除英雄,并将改动同步到服务器.</p><p>在这个章节,我们将会教大家如何响应和调用一个web服务的api.</p><p><a href="https://angular.io/resources/live-examples/toh-6/ts/plnkr.html" target="_blank" rel="noopener">在线示例</a>在此.</p><h2 id="Http准备"><a href="#Http准备" class="headerlink" title="Http准备"></a>Http准备</h2><p>Http并不是Angular的核心模块,它属于插件,分离在npm包进行管理.不过我们可以直接从@angular/http导入Http,因为systemjs.config已经配置SystemJS加载了这个库.</p><h3 id="注册http服务"><a href="#注册http服务" class="headerlink" title="注册http服务"></a>注册http服务</h3><p>http服务还依赖于其他的services,HTTP_PROVIDERS,我们需要在应用的任意一个位置接入这些服务.所以当启动应用加载根组件AppComponent的时候,需要将这些服务注册到main.ts的bootstrap中.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; bootstrap &#125;      from &apos;@angular/platform-browser-dynamic&apos;;</span><br><span class="line">import &#123; HTTP_PROVIDERS &#125; from &apos;@angular/http&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; AppComponent &#125;   from &apos;./app.component&apos;;</span><br><span class="line"></span><br><span class="line">bootstrap(AppComponent, [ HTTP_PROVIDERS ]);</span><br></pre></td></tr></table></figure><p>注意到HTTP_PROVIDERS时再一个数组中,这个和@Component的provicer效果类似.</p><h2 id="模拟web-api"><a href="#模拟web-api" class="headerlink" title="模拟web api"></a>模拟web api</h2><p>我们一般建议将应用级别的服务注册到AppComponent的provicers里,这里我们注册到main里是有特殊的原因的.</p><p>我们的应用需要经历很长一段时间的开发测试才能最终发布,那个时候我们甚至没有一个可以处理heroes的web服务,所以我们需要模拟一个,内存服务器,而这个web服务对应用来讲是透明了,它不需要知道这个是模拟环境还是真实环境,所以这部分的配置需要放到AppComponent上层来配置.</p><p><em>app/main.ts</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// Imports for loading &amp; configuring the in-memory web api</span><br><span class="line">import &#123; XHRBackend &#125; from &apos;@angular/http&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; InMemoryBackendService, SEED_DATA &#125; from &apos;angular2-in-memory-web-api&apos;;</span><br><span class="line">import &#123; InMemoryDataService &#125;               from &apos;./in-memory-data.service&apos;;</span><br><span class="line"></span><br><span class="line">// The usual bootstrapping imports</span><br><span class="line">import &#123; bootstrap &#125;      from &apos;@angular/platform-browser-dynamic&apos;;</span><br><span class="line">import &#123; HTTP_PROVIDERS &#125; from &apos;@angular/http&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; AppComponent &#125;   from &apos;./app.component&apos;;</span><br><span class="line"></span><br><span class="line">bootstrap(AppComponent, [</span><br><span class="line">    HTTP_PROVIDERS,</span><br><span class="line">    &#123; provide: XHRBackend, useClass: InMemoryBackendService &#125;, // in-mem server</span><br><span class="line">    &#123; provide: SEED_DATA, useClass: InMemoryDataService &#125;      // in-mem server data</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p>in-memory-data.service.ts文件,内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export class InMemoryDataService &#123;</span><br><span class="line">  createDb() &#123;</span><br><span class="line">    let heroes = [</span><br><span class="line">      &#123;id: 11, name: &apos;Mr. Nice&apos;&#125;,</span><br><span class="line">      &#123;id: 12, name: &apos;Narco&apos;&#125;,</span><br><span class="line">      &#123;id: 13, name: &apos;Bombasto&apos;&#125;,</span><br><span class="line">      &#123;id: 14, name: &apos;Celeritas&apos;&#125;,</span><br><span class="line">      &#123;id: 15, name: &apos;Magneta&apos;&#125;,</span><br><span class="line">      &#123;id: 16, name: &apos;RubberMan&apos;&#125;,</span><br><span class="line">      &#123;id: 17, name: &apos;Dynama&apos;&#125;,</span><br><span class="line">      &#123;id: 18, name: &apos;Dr IQ&apos;&#125;,</span><br><span class="line">      &#123;id: 19, name: &apos;Magma&apos;&#125;,</span><br><span class="line">      &#123;id: 20, name: &apos;Tornado&apos;&#125;</span><br><span class="line">    ];</span><br><span class="line">    return &#123;heroes&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>更多Http内容,查看[Http]章节.记住,in-memory-web api只在开发早期有用.</p></blockquote><h2 id="英雄和Http"><a href="#英雄和Http" class="headerlink" title="英雄和Http"></a>英雄和Http</h2><p>目前HeroService代码实现:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getHeroes() &#123;</span><br><span class="line">  return Promise.resolve(HEROES);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们返回一个模拟数据的promise解析数据,我们已经为使用Http客户端异步获取数据做好了准备:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getHeroes(): Promise&lt;Hero[]&gt; &#123;</span><br><span class="line">return this.http.get(this.heroesUrl)</span><br><span class="line">           .toPromise()</span><br><span class="line">           .then(response =&gt; response.json().data)</span><br><span class="line">           .catch(this.handleError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Http-Promise"><a href="#Http-Promise" class="headerlink" title="Http Promise"></a>Http Promise</h3><p>我们仍然返回的是一个promise,但看上去有点复杂.</p><p>Angular http.get 返回一个 RxJS的Observable. Observable是一个有效管理异步数据流的方式,稍后我们再详细讲解.</p><p>现在,我们往下看,获取Observable之后使用.toPromise()操作符将它转换为Promise.但是Angular的Observable没有toPromise方法,我们需要从RxJS库里引入额外的扩展:</p><p><code>import &#39;rxjs/add/operator/toPromise&#39;;</code></p><h3 id="解析数据并回调"><a href="#解析数据并回调" class="headerlink" title="解析数据并回调"></a>解析数据并回调</h3><p>在promise的then回调里,调用Response的json方法解析数据,json目标有一个data属性,这个data属性里就是调用者想要的英雄数组,所以我们获取这个数组,并以解析的promise值返回.调用者还是和以前一样使用这个promise的英雄数据,它不需要关心这个值是怎么来的,或者从哪里来的.</p><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>.catch(this.handleError); 抓取服务器的错误并将它传入错误处理器进行处理,这个处理函数非常关键!我们必须未雨绸缪:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private handleError(error: any) &#123;</span><br><span class="line">  console.error(&apos;An error occurred&apos;, error);</span><br><span class="line">  return Promise.reject(error.message || error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个demo服务里,我们将错误放到控制台,真实应用里,需要设计好日志管理对错误进行记录.</p><h2 id="增加-编辑-删除"><a href="#增加-编辑-删除" class="headerlink" title="增加,编辑,删除"></a>增加,编辑,删除</h2><p>我们很快有了新的需求,需要有增删改的功能.</p><h3 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h3><p>我们使用post方法来新增英雄.Post请求相比Get请求需要有更多的设置.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// Add new Hero</span><br><span class="line">private post(hero: Hero): Promise&lt;Hero&gt; &#123;</span><br><span class="line">  let headers = new Headers(&#123;</span><br><span class="line">    &apos;Content-Type&apos;: &apos;application/json&apos;&#125;);</span><br><span class="line"></span><br><span class="line">  return this.http</span><br><span class="line">             .post(this.heroesUrl, JSON.stringify(hero), &#123;headers: headers&#125;)</span><br><span class="line">             .toPromise()</span><br><span class="line">             .then(res =&gt; res.json().data)</span><br><span class="line">             .catch(this.handleError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Put"><a href="#Put" class="headerlink" title="Put"></a>Put</h3><p>put 是用来编辑一个指定英雄,但结构和post请求非常的相似.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Update existing Hero</span><br><span class="line">private put(hero: Hero) &#123;</span><br><span class="line">  let headers = new Headers();</span><br><span class="line">  headers.append(&apos;Content-Type&apos;, &apos;application/json&apos;);</span><br><span class="line"></span><br><span class="line">  let url = `$&#123;this.heroesUrl&#125;/$&#123;hero.id&#125;`;</span><br><span class="line"></span><br><span class="line">  return this.http</span><br><span class="line">             .put(url, JSON.stringify(hero), &#123;headers: headers&#125;)</span><br><span class="line">             .toPromise()</span><br><span class="line">             .then(() =&gt; hero)</span><br><span class="line">             .catch(this.handleError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><p>delete 用来删除英雄</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delete(hero: Hero) &#123;</span><br><span class="line">  let headers = new Headers();</span><br><span class="line">  headers.append(&apos;Content-Type&apos;, &apos;application/json&apos;);</span><br><span class="line"></span><br><span class="line">  let url = `$&#123;this.heroesUrl&#125;/$&#123;hero.id&#125;`;</span><br><span class="line"></span><br><span class="line">  return this.http</span><br><span class="line">             .delete(url, headers)</span><br><span class="line">             .toPromise()</span><br><span class="line">             .catch(this.handleError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Save"><a href="#Save" class="headerlink" title="Save"></a>Save</h3><p>我们将post和put方法组装成一个save方法,封装了逻辑(id存在就编辑,不存在就新增),让HeroDetailCompnent更加简洁.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">save(hero: Hero): Promise&lt;Hero&gt;  &#123;</span><br><span class="line">  if (hero.id) &#123;</span><br><span class="line">    return this.put(hero);</span><br><span class="line">  &#125;</span><br><span class="line">  return this.post(hero);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在我们的HeroService代码如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Injectable &#125;    from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Headers, Http &#125; from &apos;@angular/http&apos;;</span><br><span class="line"></span><br><span class="line">import &apos;rxjs/add/operator/toPromise&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Hero &#125; from &apos;./hero&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class HeroService &#123;</span><br><span class="line"></span><br><span class="line">  private heroesUrl = &apos;app/heroes&apos;;  // URL to web api</span><br><span class="line"></span><br><span class="line">  constructor(private http: Http) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  getHeroes(): Promise&lt;Hero[]&gt; &#123;</span><br><span class="line">    return this.http.get(this.heroesUrl)</span><br><span class="line">               .toPromise()</span><br><span class="line">               .then(response =&gt; response.json().data)</span><br><span class="line">               .catch(this.handleError);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getHero(id: number) &#123;</span><br><span class="line">    return this.getHeroes()</span><br><span class="line">               .then(heroes =&gt; heroes.filter(hero =&gt; hero.id === id)[0]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  save(hero: Hero): Promise&lt;Hero&gt;  &#123;</span><br><span class="line">    if (hero.id) &#123;</span><br><span class="line">      return this.put(hero);</span><br><span class="line">    &#125;</span><br><span class="line">    return this.post(hero);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  delete(hero: Hero) &#123;</span><br><span class="line">    let headers = new Headers();</span><br><span class="line">    headers.append(&apos;Content-Type&apos;, &apos;application/json&apos;);</span><br><span class="line"></span><br><span class="line">    let url = `$&#123;this.heroesUrl&#125;/$&#123;hero.id&#125;`;</span><br><span class="line"></span><br><span class="line">    return this.http</span><br><span class="line">               .delete(url, headers)</span><br><span class="line">               .toPromise()</span><br><span class="line">               .catch(this.handleError);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Add new Hero</span><br><span class="line">  private post(hero: Hero): Promise&lt;Hero&gt; &#123;</span><br><span class="line">    let headers = new Headers(&#123;</span><br><span class="line">      &apos;Content-Type&apos;: &apos;application/json&apos;&#125;);</span><br><span class="line"></span><br><span class="line">    return this.http</span><br><span class="line">               .post(this.heroesUrl, JSON.stringify(hero), &#123;headers: headers&#125;)</span><br><span class="line">               .toPromise()</span><br><span class="line">               .then(res =&gt; res.json().data)</span><br><span class="line">               .catch(this.handleError);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Update existing Hero</span><br><span class="line">  private put(hero: Hero) &#123;</span><br><span class="line">    let headers = new Headers();</span><br><span class="line">    headers.append(&apos;Content-Type&apos;, &apos;application/json&apos;);</span><br><span class="line"></span><br><span class="line">    let url = `$&#123;this.heroesUrl&#125;/$&#123;hero.id&#125;`;</span><br><span class="line"></span><br><span class="line">    return this.http</span><br><span class="line">               .put(url, JSON.stringify(hero), &#123;headers: headers&#125;)</span><br><span class="line">               .toPromise()</span><br><span class="line">               .then(() =&gt; hero)</span><br><span class="line">               .catch(this.handleError);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private handleError(error: any) &#123;</span><br><span class="line">    console.error(&apos;An error occurred&apos;, error);</span><br><span class="line">    return Promise.reject(error.message || error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="更新组件"><a href="#更新组件" class="headerlink" title="更新组件"></a>更新组件</h2><p>现在HeroService已经可以满足增删改的要求了,我们需要更新下对应的组件,让它支持这些功能.首先引入这些方法.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, EventEmitter, Input, OnInit, Output &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">export class HeroDetailComponent implements OnInit &#123;</span><br><span class="line">  @Input() hero: Hero;</span><br><span class="line">  @Output() close = new EventEmitter();</span><br><span class="line">  error: any;</span><br><span class="line">  navigated = false; // true if navigated here</span><br></pre></td></tr></table></figure><h3 id="增加-编辑HeroDetailComponent"><a href="#增加-编辑HeroDetailComponent" class="headerlink" title="增加/编辑HeroDetailComponent"></a>增加/编辑HeroDetailComponent</h3><p>我们已经有了HeroDetailComponent来查看指定英雄的详情.增加和编辑是详情视图的扩展,我们可以服用这个组件.原来这个组件是用于渲染一个存在的数据,现在我们需要考虑当对象为空时如何初始化hero属性.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ngOnInit() &#123;</span><br><span class="line">  if (this.routeParams.get(&apos;id&apos;) !== null) &#123;</span><br><span class="line">    let id = +this.routeParams.get(&apos;id&apos;);</span><br><span class="line">    this.navigated = true;</span><br><span class="line">    this.heroService.getHero(id)</span><br><span class="line">        .then(hero =&gt; this.hero = hero);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    this.navigated = false;</span><br><span class="line">    this.hero = new Hero();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>为了区分新增还是编辑,我们通过检查url里的id参数是否存在来判断,如果id不存在,我们将HeroDetailComponent绑定到一个空的Hero对象,如果存在则将渲染这个存在的英雄.</p><p>下一步是增加一个HeroDetailComponent方法:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">save() &#123;</span><br><span class="line">  this.heroService</span><br><span class="line">      .save(this.hero)</span><br><span class="line">      .then(hero =&gt; &#123;</span><br><span class="line">        this.hero = hero; // saved hero, w/ id if new</span><br><span class="line">        this.goBack(hero);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(error =&gt; this.error = error); // TODO: Display error message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在保存英雄以后,通过goBack重定向到之前的页面.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">goBack(savedHero: Hero = null) &#123;</span><br><span class="line">  this.close.emit(savedHero);</span><br><span class="line">  if (this.navigated) &#123; window.history.back(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里我们调用了emit,是为了通知我们刚刚增加或者修改了一个英雄. HeroesComponent监听这个通知信息,并自动刷新英雄列表.</p><h3 id="HeroesComponent里的增删"><a href="#HeroesComponent里的增删" class="headerlink" title="HeroesComponent里的增删"></a>HeroesComponent里的增删</h3><p>用户可以通过点击按钮或者输入名字的方式新增英雄.</p><p>当用户点击 Add New Hero 按钮,我们展示一个HeroDetailComponent.我们不导航到这个组件里,这样我们就不会获取到id参数,通过前面设计可知,这就表示创建一个空的英雄对象.</p><p>增加以下的HTML到heroes.component.html:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;button (click)=&quot;addHero()&quot;&gt;Add New Hero&lt;/button&gt;</span><br><span class="line">&lt;div *ngIf=&quot;addingHero&quot;&gt;</span><br><span class="line">  &lt;my-hero-detail (close)=&quot;close($event)&quot;&gt;&lt;/my-hero-detail&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>用户可以通过点击英雄名字下面的删除按钮来删除一个已存在的英雄.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button class=&quot;delete-button&quot; (click)=&quot;delete(hero, $event)&quot;&gt;Delete&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>现在让我们来修改HeroesComponent让它可以支持增删行为.</p><p>我们使用HeroDetailComponent来获取新的英雄嘻嘻,我们不得不导入并在directives数组里引用它的方式来告诉Aangular.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; HeroDetailComponent &#125; from &apos;./hero-detail.component&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;my-heroes&apos;,</span><br><span class="line">  templateUrl: &apos;app/heroes.component.html&apos;,</span><br><span class="line">  styleUrls:  [&apos;app/heroes.component.css&apos;],</span><br><span class="line">  directives: [HeroDetailComponent]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>接着,我们事先增加英雄的点击按钮:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">addHero() &#123;</span><br><span class="line">  this.addingHero = true;</span><br><span class="line">  this.selectedHero = null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">close(savedHero: Hero) &#123;</span><br><span class="line">  this.addingHero = false;</span><br><span class="line">  if (savedHero) &#123; this.getHeroes(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除的逻辑会稍微复杂点:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">delete(hero: Hero, event: any) &#123;</span><br><span class="line">  event.stopPropagation();</span><br><span class="line">  this.heroService</span><br><span class="line">      .delete(hero)</span><br><span class="line">      .then(res =&gt; &#123;</span><br><span class="line">        this.heroes = this.heroes.filter(h =&gt; h !== hero);</span><br><span class="line">        if (this.selectedHero === hero) &#123; this.selectedHero = null; &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(error =&gt; this.error = error); // TODO: Display error message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>让我们来看看现在应用的效果:</p><h3 id="应用结构如下"><a href="#应用结构如下" class="headerlink" title="应用结构如下:"></a>应用结构如下:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">angular2-tour-of-heroes</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line"></span><br><span class="line">--app.component.ts</span><br><span class="line"></span><br><span class="line">--component.css</span><br><span class="line"></span><br><span class="line">--dashboard.component.css</span><br><span class="line"></span><br><span class="line">--dashboard.component.html</span><br><span class="line"></span><br><span class="line">--dashboard.component.ts</span><br><span class="line"></span><br><span class="line">--hero.ts</span><br><span class="line"></span><br><span class="line">--hero-detail.component.css</span><br><span class="line"></span><br><span class="line">--hero-detail.component.html</span><br><span class="line"></span><br><span class="line">--hero-detail.component.ts</span><br><span class="line"></span><br><span class="line">--hero.service.ts</span><br><span class="line"></span><br><span class="line">--heroes.component.css</span><br><span class="line"></span><br><span class="line">--heroes.component.html</span><br><span class="line"></span><br><span class="line">--heroes.component.ts</span><br><span class="line"></span><br><span class="line">--main.ts</span><br><span class="line"></span><br><span class="line">--hero-data.service.ts</span><br><span class="line"></span><br><span class="line">node_modules ...</span><br><span class="line"></span><br><span class="line">typings ...</span><br><span class="line"></span><br><span class="line">index.html</span><br><span class="line"></span><br><span class="line">package.json</span><br><span class="line"></span><br><span class="line">styles.css</span><br><span class="line"></span><br><span class="line">sample.css</span><br><span class="line"></span><br><span class="line">systemjs.config.json</span><br><span class="line"></span><br><span class="line">tsconfig.json</span><br><span class="line"></span><br><span class="line">typings.json</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此本教程结束了,代码打包.</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Angularjs2/" rel="tag"># Angularjs2</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/06/14/Rich-Dad-Poor-Dad/" rel="next" title="穷爸爸富爸爸"><i class="fa fa-chevron-left"></i> 穷爸爸富爸爸</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2016/06/30/Shortest-History-of-Europe/" rel="prev" title="极简欧洲史">极简欧洲史<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/res/avatar.png" alt="lizorn"><p class="site-author-name" itemprop="name">lizorn</p><p class="site-description motion-element" itemprop="description">想法永远是错的，除非事实证明它是对的。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">68</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">19</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">89</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:mail@lizorn.com" title="E-Mail &rarr; mailto:mail@lizorn.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/about/" title="关于我 &rarr; /about/"><i class="fa fa-fw fa-user"></i> 关于我</a></span><span class="links-of-author-item"><a href="https://github.com/LiZoRN/" title="GitHub &rarr; https://github.com/LiZoRN/" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="/res/weixin.jpg" title="微信 &rarr; /res/weixin.jpg"><i class="fa fa-fw fa-weixin"></i> 微信</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#介绍"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#英雄之旅-预览"><span class="nav-number">1.1.</span> <span class="nav-text">英雄之旅:预览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#最终效果"><span class="nav-number">1.2.</span> <span class="nav-text">最终效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下一步"><span class="nav-number">1.3.</span> <span class="nav-text">下一步</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#英雄编辑器"><span class="nav-number">2.</span> <span class="nav-text">英雄编辑器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#从前…"><span class="nav-number">2.1.</span> <span class="nav-text">从前…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保持app在线编译和运行"><span class="nav-number">2.2.</span> <span class="nav-text">保持app在线编译和运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#英雄展示"><span class="nav-number">2.3.</span> <span class="nav-text">英雄展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#英雄对象"><span class="nav-number">2.3.1.</span> <span class="nav-text">英雄对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改HTML模板"><span class="nav-number">2.3.2.</span> <span class="nav-text">修改HTML模板</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑英雄"><span class="nav-number">2.4.</span> <span class="nav-text">编辑英雄</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#双向绑定"><span class="nav-number">2.4.1.</span> <span class="nav-text">双向绑定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本章小结"><span class="nav-number">2.4.2.</span> <span class="nav-text">本章小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#未来之路"><span class="nav-number">2.4.3.</span> <span class="nav-text">未来之路</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Master-Detail"><span class="nav-number">3.</span> <span class="nav-text">Master/Detail</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#有很多英雄"><span class="nav-number">3.1.</span> <span class="nav-text">有很多英雄</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#显示英雄们"><span class="nav-number">3.2.</span> <span class="nav-text">显示英雄们</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建英雄数据"><span class="nav-number">3.2.1.</span> <span class="nav-text">创建英雄数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#展示英雄"><span class="nav-number">3.2.2.</span> <span class="nav-text">展示英雄</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在模板里展示英雄"><span class="nav-number">3.2.3.</span> <span class="nav-text">在模板里展示英雄</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ngFor展示英雄列表"><span class="nav-number">3.2.4.</span> <span class="nav-text">使用ngFor展示英雄列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#样式化"><span class="nav-number">3.2.5.</span> <span class="nav-text">样式化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#选择英雄"><span class="nav-number">3.3.</span> <span class="nav-text">选择英雄</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#点击事件"><span class="nav-number">3.3.1.</span> <span class="nav-text">点击事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加点击句柄"><span class="nav-number">3.3.2.</span> <span class="nav-text">增加点击句柄</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#声明选择的英雄"><span class="nav-number">3.3.3.</span> <span class="nav-text">声明选择的英雄</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ngIf过滤空异常"><span class="nav-number">3.3.4.</span> <span class="nav-text">使用ngIf过滤空异常</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#美化slection"><span class="nav-number">3.3.5.</span> <span class="nav-text">美化slection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">3.4.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多组件"><span class="nav-number">4.</span> <span class="nav-text">多组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#构建一个英雄详情组件"><span class="nav-number">4.1.</span> <span class="nav-text">构建一个英雄详情组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分离英雄详情组件"><span class="nav-number">4.1.1.</span> <span class="nav-text">分离英雄详情组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#英雄详情模板"><span class="nav-number">4.1.2.</span> <span class="nav-text">英雄详情模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加hero特性"><span class="nav-number">4.1.3.</span> <span class="nav-text">增加hero特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hero特性是输入"><span class="nav-number">4.1.4.</span> <span class="nav-text">hero特性是输入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新AppComponent"><span class="nav-number">4.2.</span> <span class="nav-text">更新AppComponent</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#指令数组"><span class="nav-number">4.2.1.</span> <span class="nav-text">指令数组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结-1"><span class="nav-number">4.3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#未来之路-1"><span class="nav-number">4.4.</span> <span class="nav-text">未来之路</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Services"><span class="nav-number">5.</span> <span class="nav-text">Services</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建一个英雄Service"><span class="nav-number">5.1.</span> <span class="nav-text">创建一个英雄Service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个HeroService"><span class="nav-number">5.1.1.</span> <span class="nav-text">创建一个HeroService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Heros"><span class="nav-number">5.1.2.</span> <span class="nav-text">获取Heros</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模拟英雄数据"><span class="nav-number">5.1.3.</span> <span class="nav-text">模拟英雄数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回模拟英雄数据"><span class="nav-number">5.1.4.</span> <span class="nav-text">返回模拟英雄数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用英雄Service"><span class="nav-number">5.1.5.</span> <span class="nav-text">使用英雄Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ngOnInit生命周期Hook"><span class="nav-number">5.1.6.</span> <span class="nav-text">ngOnInit生命周期Hook</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异步服务和Promises"><span class="nav-number">5.2.</span> <span class="nav-text">异步服务和Promises</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Promise"><span class="nav-number">5.2.1.</span> <span class="nav-text">使用Promise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看APP结构"><span class="nav-number">5.2.2.</span> <span class="nav-text">查看APP结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结-2"><span class="nav-number">5.3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下一章"><span class="nav-number">5.4.</span> <span class="nav-text">下一章</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#路由"><span class="nav-number">6.</span> <span class="nav-text">路由</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#计划"><span class="nav-number">6.1.</span> <span class="nav-text">计划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重组AppComponent"><span class="nav-number">6.2.</span> <span class="nav-text">重组AppComponent</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HerosComponent"><span class="nav-number">6.2.1.</span> <span class="nav-text">HerosComponent</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建AppComponent"><span class="nav-number">6.3.</span> <span class="nav-text">创建AppComponent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加路由"><span class="nav-number">6.4.</span> <span class="nav-text">增加路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设置基础标签"><span class="nav-number">6.4.1.</span> <span class="nav-text">设置基础标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使路由可见"><span class="nav-number">6.4.2.</span> <span class="nav-text">使路由可见</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加配置路由器"><span class="nav-number">6.4.3.</span> <span class="nav-text">增加配置路由器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由器出口"><span class="nav-number">6.4.4.</span> <span class="nav-text">路由器出口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由器链接"><span class="nav-number">6.4.5.</span> <span class="nav-text">路由器链接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加一个仪表盘"><span class="nav-number">6.5.</span> <span class="nav-text">增加一个仪表盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置dashboard路由"><span class="nav-number">6.5.1.</span> <span class="nav-text">配置dashboard路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dashboard顶级英雄"><span class="nav-number">6.6.</span> <span class="nav-text">Dashboard顶级英雄</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#共享HeroService"><span class="nav-number">6.6.1.</span> <span class="nav-text">共享HeroService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取heroes"><span class="nav-number">6.6.2.</span> <span class="nav-text">获取heroes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#导航到英雄详情"><span class="nav-number">6.7.</span> <span class="nav-text">导航到英雄详情</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#路由到英雄详情"><span class="nav-number">6.7.1.</span> <span class="nav-text">路由到英雄详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由参数"><span class="nav-number">6.7.2.</span> <span class="nav-text">路由参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加HeroService-getHero"><span class="nav-number">6.7.3.</span> <span class="nav-text">增加HeroService.getHero</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回"><span class="nav-number">6.7.4.</span> <span class="nav-text">返回</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#选择一个Dashboard英雄"><span class="nav-number">6.8.</span> <span class="nav-text">选择一个Dashboard英雄</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HerosComponent里选择一个英雄"><span class="nav-number">6.9.</span> <span class="nav-text">HerosComponent里选择一个英雄</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加一个mini-detail"><span class="nav-number">6.9.1.</span> <span class="nav-text">增加一个mini-detail</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#App样式"><span class="nav-number">6.10.</span> <span class="nav-text">App样式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dashboard样式"><span class="nav-number">6.10.1.</span> <span class="nav-text">Dashboard样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#英雄详情界面优化"><span class="nav-number">6.10.2.</span> <span class="nav-text">英雄详情界面优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导航链接界面优化"><span class="nav-number">6.10.3.</span> <span class="nav-text">导航链接界面优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用全局样式"><span class="nav-number">6.10.4.</span> <span class="nav-text">应用全局样式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结-3"><span class="nav-number">6.11.</span> <span class="nav-text">小结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#未来之路-2"><span class="nav-number">6.11.1.</span> <span class="nav-text">未来之路</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Http"><span class="nav-number">7.</span> <span class="nav-text">Http</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Http准备"><span class="nav-number">7.1.</span> <span class="nav-text">Http准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注册http服务"><span class="nav-number">7.1.1.</span> <span class="nav-text">注册http服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模拟web-api"><span class="nav-number">7.2.</span> <span class="nav-text">模拟web api</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#英雄和Http"><span class="nav-number">7.3.</span> <span class="nav-text">英雄和Http</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Http-Promise"><span class="nav-number">7.3.1.</span> <span class="nav-text">Http Promise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析数据并回调"><span class="nav-number">7.3.2.</span> <span class="nav-text">解析数据并回调</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#错误处理"><span class="nav-number">7.3.3.</span> <span class="nav-text">错误处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加-编辑-删除"><span class="nav-number">7.4.</span> <span class="nav-text">增加,编辑,删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Post"><span class="nav-number">7.4.1.</span> <span class="nav-text">Post</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Put"><span class="nav-number">7.4.2.</span> <span class="nav-text">Put</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delete"><span class="nav-number">7.4.3.</span> <span class="nav-text">Delete</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Save"><span class="nav-number">7.4.4.</span> <span class="nav-text">Save</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新组件"><span class="nav-number">7.5.</span> <span class="nav-text">更新组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加-编辑HeroDetailComponent"><span class="nav-number">7.5.1.</span> <span class="nav-text">增加/编辑HeroDetailComponent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HeroesComponent里的增删"><span class="nav-number">7.5.2.</span> <span class="nav-text">HeroesComponent里的增删</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用结构如下"><span class="nav-number">7.5.3.</span> <span class="nav-text">应用结构如下:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">7.6.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">lizorn</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/src/utils.js?v=6.7.0"></script><script src="/js/src/motion.js?v=6.7.0"></script><script src="/js/src/schemes/muse.js?v=6.7.0"></script><script src="/js/src/scrollspy.js?v=6.7.0"></script><script src="/js/src/post-details.js?v=6.7.0"></script><script src="/js/src/bootstrap.js?v=6.7.0"></script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:50,height:100,hOffset:0},mobile:{show:!0}})</script></body></html>